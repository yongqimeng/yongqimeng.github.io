{"title":"封装canvas画分享图能力","uid":"5ec98a85a99b57e340a9a2a9ff61c2c1","slug":"canvas-screenshot","date":"2024-08-29T12:52:43.149Z","updated":"2024-08-29T12:53:27.162Z","comments":true,"path":"api/articles/canvas-screenshot.json","keywords":null,"cover":"/images/cover1.jpg","content":"<p>整理了一下工作中封装的画分享海报的能力</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">ShareCanvas</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">config</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">width</span> = config.<span class=\"property\">width</span> || <span class=\"number\">375</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">height</span> = config.<span class=\"property\">height</span> || <span class=\"number\">616</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span> = config.<span class=\"property\">scale</span> || <span class=\"number\">3</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">canvasDom</span> = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;canvas&#x27;</span>);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">canvasDom</span>.<span class=\"title function_\">getContext</span>(<span class=\"string\">&#x27;2d&#x27;</span>);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">canvasDom</span>.<span class=\"property\">width</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">width</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">canvasDom</span>.<span class=\"property\">height</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">height</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!config?.<span class=\"property\">hidden</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">appendChild</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">canvasDom</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * url  图片url</span></span><br><span class=\"line\"><span class=\"comment\">     * x x轴</span></span><br><span class=\"line\"><span class=\"comment\">     * y  y轴</span></span><br><span class=\"line\"><span class=\"comment\">     * width 图片宽度</span></span><br><span class=\"line\"><span class=\"comment\">     * height 图片高</span></span><br><span class=\"line\"><span class=\"comment\">     * radius  传值则画圆角图片</span></span><br><span class=\"line\"><span class=\"comment\">     * rotate 旋转</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"title function_\">drawImg</span>(<span class=\"params\">config</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> promise = <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> img = <span class=\"keyword\">new</span> <span class=\"title class_\">Image</span>();</span><br><span class=\"line\">            img.<span class=\"property\">onload</span> = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (config.<span class=\"property\">bgColor</span>) &#123;</span><br><span class=\"line\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">fillStyle</span> = config.<span class=\"property\">bgColor</span>;</span><br><span class=\"line\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">fillRect</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, config.<span class=\"property\">x</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>, config.<span class=\"property\">y</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>);</span><br><span class=\"line\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">restore</span>();</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">save</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (config.<span class=\"property\">filter</span>) &#123;</span><br><span class=\"line\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">filter</span> = config.<span class=\"property\">filter</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (config.<span class=\"property\">opacity</span>) &#123;</span><br><span class=\"line\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">globalAlpha</span> = config.<span class=\"property\">opacity</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (config.<span class=\"property\">radius</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 传radius可画圆角头像</span></span><br><span class=\"line\">                    config.<span class=\"property\">radius</span> = config.<span class=\"property\">radius</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">                    config.<span class=\"property\">x</span> = config.<span class=\"property\">x</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">                    config.<span class=\"property\">y</span> = config.<span class=\"property\">y</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">                    <span class=\"comment\">// this.ctx.save();</span></span><br><span class=\"line\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">beginPath</span>();</span><br><span class=\"line\">                    <span class=\"keyword\">const</span> size = <span class=\"number\">2</span> * config.<span class=\"property\">radius</span>;</span><br><span class=\"line\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">arc</span>(config.<span class=\"property\">x</span>, config.<span class=\"property\">y</span>, config.<span class=\"property\">radius</span>, <span class=\"number\">0</span>, <span class=\"number\">2</span> * <span class=\"title class_\">Math</span>.<span class=\"property\">PI</span>);</span><br><span class=\"line\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">clip</span>();</span><br><span class=\"line\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">drawImage</span>(img, (config.<span class=\"property\">x</span> - config.<span class=\"property\">radius</span>), (config.<span class=\"property\">y</span> - config.<span class=\"property\">radius</span>), size, size);</span><br><span class=\"line\">                    <span class=\"comment\">// this.ctx.restore();</span></span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(config.<span class=\"property\">rotate</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">let</span> rotateX = config.<span class=\"property\">x</span>;</span><br><span class=\"line\">                        <span class=\"keyword\">let</span> rotateY = config.<span class=\"property\">y</span>;</span><br><span class=\"line\">                        <span class=\"keyword\">let</span> offsetX = <span class=\"number\">0</span>;</span><br><span class=\"line\">                        <span class=\"keyword\">let</span> offsetY = <span class=\"number\">0</span>;</span><br><span class=\"line\">                        <span class=\"comment\">// 围绕图片中心点旋转</span></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (config.<span class=\"property\">rotateAroundCenter</span>) &#123;</span><br><span class=\"line\">                            offsetX = config.<span class=\"property\">width</span> / <span class=\"number\">2</span>;</span><br><span class=\"line\">                            offsetY = config.<span class=\"property\">height</span> / <span class=\"number\">2</span>;</span><br><span class=\"line\">                            rotateX += offsetX;</span><br><span class=\"line\">                            rotateY += offsetY;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">save</span>();</span><br><span class=\"line\">                        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">translate</span>(rotateX * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>, rotateY * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>);</span><br><span class=\"line\">                        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">rotate</span>(config.<span class=\"property\">rotate</span> * <span class=\"title class_\">Math</span>.<span class=\"property\">PI</span> / <span class=\"number\">180</span>);</span><br><span class=\"line\">                        <span class=\"variable language_\">this</span>.<span class=\"title function_\">drawBorderRadius</span>(config);</span><br><span class=\"line\">                        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">drawImage</span>(img, -offsetX, -offsetY, (config.<span class=\"property\">width</span> || <span class=\"variable language_\">this</span>.<span class=\"property\">width</span>) * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>, (config.<span class=\"property\">height</span> || <span class=\"variable language_\">this</span>.<span class=\"property\">height</span>) * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>);</span><br><span class=\"line\">                        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">setTransform</span>(<span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">                        <span class=\"comment\">// this.ctx.restore();</span></span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"variable language_\">this</span>.<span class=\"title function_\">drawBorderRadius</span>(config);</span><br><span class=\"line\">                        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">drawImage</span>(img, config.<span class=\"property\">x</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>, config.<span class=\"property\">y</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>, (config.<span class=\"property\">width</span> || <span class=\"variable language_\">this</span>.<span class=\"property\">width</span>) * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>, (config.<span class=\"property\">height</span> || <span class=\"variable language_\">this</span>.<span class=\"property\">height</span>) * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">restore</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"title function_\">resolve</span>();</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            img.<span class=\"property\">onerror</span> = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"title function_\">reject</span>(e);</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            img.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&#x27;crossOrigin&#x27;</span>, <span class=\"string\">&#x27;anonymous&#x27;</span>);</span><br><span class=\"line\">            img.<span class=\"property\">src</span> = config.<span class=\"property\">url</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> promise;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">drawTextWithShadow</span>(<span class=\"params\">cssStyle, text, x, y</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 解析CSS样式</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> styleParts = cssStyle.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;,&#x27;</span>).<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">part</span>) =&gt;</span> part.<span class=\"title function_\">trim</span>());</span><br><span class=\"line\">        <span class=\"keyword\">const</span> shadowStyles = styleParts.<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">part</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> [offsetX, offsetY, color] = part.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27; &#x27;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">                <span class=\"attr\">offsetX</span>: <span class=\"built_in\">parseFloat</span>(offsetX),</span><br><span class=\"line\">                <span class=\"attr\">offsetY</span>: <span class=\"built_in\">parseFloat</span>(offsetY),</span><br><span class=\"line\">                color,</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 绘制字体描边</span></span><br><span class=\"line\">        shadowStyles.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">style</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">shadowOffsetX</span> = style.<span class=\"property\">offsetX</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">shadowOffsetY</span> = style.<span class=\"property\">offsetY</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">shadowColor</span> = style.<span class=\"property\">color</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">fillText</span>(text, x, y);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 绘制字体本身</span></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">shadowColor</span> = <span class=\"string\">&#x27;transparent&#x27;</span>; <span class=\"comment\">// 清除阴影设置</span></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">fillText</span>(text, x, y);</span><br><span class=\"line\">        <span class=\"comment\">// this.ctx.restore();</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">drawBorderRadius</span>(<span class=\"params\">config</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (config.<span class=\"property\">border_radius</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 绘制圆角图片</span></span><br><span class=\"line\">            <span class=\"keyword\">const</span> borderRadius = config.<span class=\"property\">border_radius</span>;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> x = config.<span class=\"property\">x</span>;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> y = config.<span class=\"property\">y</span>;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> width = config.<span class=\"property\">width</span>;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> height = config.<span class=\"property\">height</span>;</span><br><span class=\"line\">            <span class=\"comment\">// this.ctx.save();</span></span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">beginPath</span>();</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">moveTo</span>(x + borderRadius, y);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">lineTo</span>(x + width - borderRadius, y);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">arcTo</span>(x + width, y, x + width, y + borderRadius, borderRadius);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">lineTo</span>(x + width, y + height - borderRadius);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">arcTo</span>(x + width, y + height, x + width - borderRadius, y + height, borderRadius);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">lineTo</span>(x + borderRadius, y + height);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">arcTo</span>(x, y + height, x, y + height - borderRadius, borderRadius);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">lineTo</span>(x, y + borderRadius);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">arcTo</span>(x, y, x + borderRadius, y, borderRadius);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">closePath</span>();</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">clip</span>();</span><br><span class=\"line\">            <span class=\"comment\">// this.ctx.restore();</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">filterText</span>(<span class=\"params\">str, width, x, y, fixedText = <span class=\"string\">&#x27;&#x27;</span>, tail = <span class=\"number\">10</span>, isStroke, right, bottom, textShadow</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> widthBox = (width || <span class=\"variable language_\">this</span>.<span class=\"property\">width</span>) * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> fixedTextWidth = <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">measureText</span>(fixedText).<span class=\"property\">width</span>;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> maxWidth = (widthBox - (tail * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>)) - fixedTextWidth;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> strWidth = <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">measureText</span>(str).<span class=\"property\">width</span>;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> ellipsis = <span class=\"string\">&#x27;... &#x27;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> ellipsisWidth = <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">measureText</span>(ellipsis).<span class=\"property\">width</span>;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> text = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (strWidth &lt;= maxWidth || maxWidth &lt;= ellipsisWidth) &#123;</span><br><span class=\"line\">            text = str + fixedText;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> len = str.<span class=\"property\">length</span>;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (strWidth &gt;= maxWidth - ellipsisWidth &amp;&amp; len-- &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                str = str.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, len);</span><br><span class=\"line\">                strWidth = <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">measureText</span>(str).<span class=\"property\">width</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            text = str + ellipsis + fixedText;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> finalX = x * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> finalY = y * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 没有传x且传了right, 就按right去定位</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!x &amp;&amp; right) &#123;</span><br><span class=\"line\">            finalX = widthBox - right;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 没有传y且传了bottom, 就按bottom去定位</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!y &amp;&amp; bottom) &#123;</span><br><span class=\"line\">            finalY = <span class=\"variable language_\">this</span>.<span class=\"property\">height</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span> - bottom;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (textShadow) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"title function_\">drawTextWithShadow</span>(textShadow, text, finalX, finalY);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (isStroke) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">fillText</span>(text, finalX, finalY);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">strokeText</span>(text, finalX, finalY);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">fillText</span>(text, finalX, finalY);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">restore</span>();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">filterMultiLineText</span>(<span class=\"params\">config, x, y, isStroke</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; lineHeight, text, lineLimit, fontSize, whiteSpace, textShadow &#125; = config || &#123;&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!lineHeight) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">let</span> textRows = [];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (whiteSpace &amp;&amp; whiteSpace.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&#x27;pre&#x27;</span>) !== -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            textRows = text.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;\\n&#x27;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (lineLimit) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; text.<span class=\"property\">length</span>; i += lineLimit) &#123;</span><br><span class=\"line\">                textRows.<span class=\"title function_\">push</span>(text.<span class=\"title function_\">substring</span>(i, i + lineLimit));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> finalX = x * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> finalY = (y - fontSize) * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; textRows.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> line = textRows[i];</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">textBaseline</span> = <span class=\"string\">&#x27;top&#x27;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (textShadow) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"title function_\">drawTextWithShadow</span>(textShadow, line, finalX, finalY);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (isStroke) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">fillText</span>(line, finalX, finalY);</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">strokeText</span>(line, finalX, finalY);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">fillText</span>(line, finalX, finalY);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            finalY += lineHeight * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">restore</span>();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">        text: 文字</span></span><br><span class=\"line\"><span class=\"comment\">        x: x轴</span></span><br><span class=\"line\"><span class=\"comment\">        y: y轴</span></span><br><span class=\"line\"><span class=\"comment\">        right: 距离右边的距离</span></span><br><span class=\"line\"><span class=\"comment\">        bottom: 距离下边的距离</span></span><br><span class=\"line\"><span class=\"comment\">        width: 文字宽度</span></span><br><span class=\"line\"><span class=\"comment\">        color: 文字颜色</span></span><br><span class=\"line\"><span class=\"comment\">        fontSize: 文字大小</span></span><br><span class=\"line\"><span class=\"comment\">        strokeColor: 描边颜色</span></span><br><span class=\"line\"><span class=\"comment\">        lineWidth: 描边宽度</span></span><br><span class=\"line\"><span class=\"comment\">        fontFamily: 字体</span></span><br><span class=\"line\"><span class=\"comment\">        fontBold: 字体是否加粗</span></span><br><span class=\"line\"><span class=\"comment\">        textAlign: 文字对齐方式</span></span><br><span class=\"line\"><span class=\"comment\">        lineHeight: 行高</span></span><br><span class=\"line\"><span class=\"comment\">        shadowColor: 文字阴影颜色</span></span><br><span class=\"line\"><span class=\"comment\">        shadowOffsetX: 文字阴影x轴</span></span><br><span class=\"line\"><span class=\"comment\">        shadowOffsetY: 文字阴影y轴</span></span><br><span class=\"line\"><span class=\"comment\">        shadowBlur: 文字阴影模糊</span></span><br><span class=\"line\"><span class=\"comment\">        letterSpacing 文字间距</span></span><br><span class=\"line\"><span class=\"comment\">        rotate 旋转</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"title function_\">strokeText</span>(<span class=\"params\">config</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> textAlign = config.<span class=\"property\">textAlign</span> || <span class=\"string\">&#x27;center&#x27;</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 当x为0或者未传时，重新设置x，使文字能在容器内呈现与html css样式一样的效果</span></span><br><span class=\"line\">        <span class=\"comment\">// 不重写的话，当x为0，textaligh为center时，文字将超出屏幕只画一半</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> finalWidth = config.<span class=\"property\">width</span> || <span class=\"variable language_\">this</span>.<span class=\"property\">width</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; bottom, right, rotate &#125; = config;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> finalX = config.<span class=\"property\">x</span>;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> finalY = config.<span class=\"property\">y</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!finalX &amp;&amp; !right) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (textAlign === <span class=\"string\">&#x27;center&#x27;</span>) &#123;</span><br><span class=\"line\">                finalX = finalWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (textAlign === <span class=\"string\">&#x27;right&#x27;</span>) &#123;</span><br><span class=\"line\">                finalX = finalWidth;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">textAlign</span> = textAlign ;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">save</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (rotate) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">translate</span>(finalX, finalY);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">rotate</span>(rotate * <span class=\"title class_\">Math</span>.<span class=\"property\">PI</span> / <span class=\"number\">180</span>);</span><br><span class=\"line\">            finalX = <span class=\"number\">0</span>;</span><br><span class=\"line\">            finalY = <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (config.<span class=\"property\">strokeColor</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">strokeStyle</span> = config.<span class=\"property\">strokeColor</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">lineWidth</span> = config.<span class=\"property\">lineWidth</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">font</span> = <span class=\"string\">`<span class=\"subst\">$&#123;config.fontBold || <span class=\"string\">&#x27;400&#x27;</span>&#125;</span> <span class=\"subst\">$&#123;(config.fontSize || <span class=\"number\">17</span>) * <span class=\"variable language_\">this</span>.scale&#125;</span>px <span class=\"subst\">$&#123;config.fontFamily || <span class=\"string\">&#x27;PingFang SC&#x27;</span>&#125;</span>`</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">fillStyle</span> = config.<span class=\"property\">color</span> || <span class=\"string\">&#x27;rgba(255, 255, 255, 1)&#x27;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (config.<span class=\"property\">lineHeight</span> || config.<span class=\"property\">whiteSpace</span> === <span class=\"string\">&#x27;pre&#x27;</span>) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"title function_\">filterMultiLineText</span>(config, finalX, finalY, <span class=\"literal\">true</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"title function_\">filterText</span>(config.<span class=\"property\">text</span>, finalWidth, finalX, finalY, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"number\">10</span>, <span class=\"literal\">true</span>, right, bottom, config.<span class=\"property\">textShadow</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (config.<span class=\"property\">shadowColor</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> &#123; shadowColor, shadowOffsetX, shadowOffsetY, shadowBlur &#125; = config;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">shadowColor</span> = shadowColor;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">shadowOffsetX</span> = shadowOffsetX;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">shadowOffsetY</span> = shadowOffsetY;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">shadowBlur</span> = shadowBlur;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">fillStyle</span> = config.<span class=\"property\">color</span> || <span class=\"string\">&#x27;rgba(255, 255, 255, 1)&#x27;</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">canvasDom</span>.<span class=\"property\">style</span>.<span class=\"property\">letterSpacing</span> = config.<span class=\"property\">letterSpacing</span> || <span class=\"string\">&#x27;0px&#x27;</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">font</span> = <span class=\"string\">`<span class=\"subst\">$&#123;config.fontBold || <span class=\"string\">&#x27;400&#x27;</span>&#125;</span> <span class=\"subst\">$&#123;(config.fontSize || <span class=\"number\">17</span>) * <span class=\"variable language_\">this</span>.scale&#125;</span>px <span class=\"subst\">$&#123;config.fontFamily || <span class=\"string\">&#x27;PingFang SC&#x27;</span>&#125;</span>`</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (config.<span class=\"property\">lineHeight</span> || config.<span class=\"property\">whiteSpace</span> === <span class=\"string\">&#x27;pre&#x27;</span>) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"title function_\">filterMultiLineText</span>(config, finalX, finalY, <span class=\"literal\">false</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">this</span>.<span class=\"title function_\">filterText</span>(config.<span class=\"property\">text</span>, finalWidth, finalX, finalY, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"number\">10</span>, <span class=\"literal\">false</span>, right, bottom, config.<span class=\"property\">textShadow</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">        x: x轴</span></span><br><span class=\"line\"><span class=\"comment\">        y: y轴</span></span><br><span class=\"line\"><span class=\"comment\">        width: 矩形宽度</span></span><br><span class=\"line\"><span class=\"comment\">        height: 文字颜色</span></span><br><span class=\"line\"><span class=\"comment\">        radius: 矩形的圆角</span></span><br><span class=\"line\"><span class=\"comment\">        linewidth: 描边宽度</span></span><br><span class=\"line\"><span class=\"comment\">        fillColor: 填充颜色</span></span><br><span class=\"line\"><span class=\"comment\">        strokeColor: 描边颜色</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"title function_\">roundReact</span>(<span class=\"params\">reactConfig</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 圆角矩形</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> x = reactConfig.<span class=\"property\">x</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> y = reactConfig.<span class=\"property\">y</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> width = reactConfig.<span class=\"property\">width</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> height = reactConfig.<span class=\"property\">height</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> radius = (reactConfig.<span class=\"property\">radius</span> || <span class=\"number\">0</span>) * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">beginPath</span>();</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">lineWidth</span> = (reactConfig.<span class=\"property\">lineWidth</span> || <span class=\"number\">0</span>) * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">moveTo</span>(x + radius, y);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">lineTo</span>(x + width - radius, y);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">quadraticCurveTo</span>(x + width, y, x + width, y + radius);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">lineTo</span>(x + width, y + height - radius);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">quadraticCurveTo</span>(x + width, y + height, x + width - radius, y + height);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">lineTo</span>(x + radius, y + height);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">quadraticCurveTo</span>(x, y + height, x, y + height - radius);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">lineTo</span>(x, y + radius);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">quadraticCurveTo</span>(x, y, x + radius, y);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">fillStyle</span> = reactConfig.<span class=\"property\">fillColor</span> || <span class=\"string\">&#x27;rgba(0, 0, 0, 0.5)&#x27;</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">strokeStyle</span> = reactConfig.<span class=\"property\">strokeColor</span> || <span class=\"string\">&#x27;rgba(0, 0, 0, 0)&#x27;</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">closePath</span>();</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">fill</span>();</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">stroke</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">        width: 矩形宽度</span></span><br><span class=\"line\"><span class=\"comment\">        height: 文字颜色</span></span><br><span class=\"line\"><span class=\"comment\">        bgColor: 背景颜色</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"title function_\">fillColor</span>(<span class=\"params\">config</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!config?.<span class=\"property\">bgColor</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> width = config.<span class=\"property\">width</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> height = config.<span class=\"property\">height</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"property\">fillStyle</span> = config.<span class=\"property\">bgColor</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">fillRect</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, width, height);</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">ctx</span>.<span class=\"title function_\">restore</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">toDataURL</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">canvasDom</span>.<span class=\"title function_\">toDataURL</span>(<span class=\"string\">&#x27;image/png&#x27;</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">updateInstance</span>(<span class=\"params\">config</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">width</span> = config.<span class=\"property\">width</span> || <span class=\"number\">375</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">height</span> = config.<span class=\"property\">height</span> || <span class=\"number\">616</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span> = config.<span class=\"property\">scale</span> || <span class=\"number\">3</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">canvasDom</span>.<span class=\"property\">width</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">width</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">canvasDom</span>.<span class=\"property\">height</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">height</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">scale</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","text":"整理了一下工作中封装的画分享海报的能力 class ShareCanvas { constructor(config) { this.width = confi...","permalink":"/post/canvas-screenshot","photos":[],"count_time":{"symbolsCount":"14k","symbolsTime":"13 mins."},"categories":[{"name":"canvas","slug":"canvas","count":1,"path":"api/categories/canvas.json"}],"tags":[{"name":"canvas","slug":"canvas","count":1,"path":"api/tags/canvas.json"}],"toc":"","author":{"name":"M","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"这是我的博客","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"记一次git报错","uid":"c0b4ed83bb36ebf80bf9643e36e3db7c","slug":"git-clone-error","date":"2024-09-05T12:16:52.568Z","updated":"2024-09-05T12:16:52.568Z","comments":true,"path":"api/articles/git-clone-error.json","keywords":null,"cover":"/images/cover1.jpg","text":"记一次使用git报错，解决Unable to negotiate with **** port 22: no matching host key type fo...","permalink":"/post/git-clone-error","photos":[],"count_time":{"symbolsCount":868,"symbolsTime":"1 mins."},"categories":[{"name":"git","slug":"git","count":2,"path":"api/categories/git.json"}],"tags":[{"name":"git","slug":"git","count":2,"path":"api/tags/git.json"}],"author":{"name":"M","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"这是我的博客","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"多行文本展开收起的实现方式","uid":"53e70211b9fa8a0658b9a8cefd096926","slug":"full-text","date":"2024-08-29T12:52:38.496Z","updated":"2024-08-29T12:53:19.195Z","comments":true,"path":"api/articles/full-text.json","keywords":null,"cover":"/images/cover1.jpg","text":"多行文本超过指定行数，进行文本截断并显示省略号，并通过展开和收起来控制是否显示全部内容，调研很多种方式，目前这个是最合适的且最终的实现方案。 具体代码 <tem...","permalink":"/post/full-text","photos":[],"count_time":{"symbolsCount":"2.7k","symbolsTime":"2 mins."},"categories":[{"name":"html&css","slug":"html-css","count":3,"path":"api/categories/html-css.json"}],"tags":[{"name":"html&css","slug":"html-css","count":3,"path":"api/tags/html-css.json"}],"author":{"name":"M","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"这是我的博客","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}