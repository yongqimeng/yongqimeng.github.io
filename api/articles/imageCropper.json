{"title":"二次封装图片裁切组件","uid":"dd5ab0341bc990a4e66b615b8fc3d65b","slug":"imageCropper","date":"2025-07-26T03:34:56.000Z","updated":"2025-09-18T09:01:04.397Z","comments":true,"path":"api/articles/imageCropper.json","keywords":null,"cover":"/images/cover1.jpg","content":"<h2 id=\"二次封装图片裁切组件\"><a href=\"#二次封装图片裁切组件\" class=\"headerlink\" title=\"二次封装图片裁切组件\"></a>二次封装图片裁切组件</h2><h3 id=\"最近有个需求上传图片后，需要裁切图片，然后上传到阿里OSS服务器，这里记录一下封装的组件代码\"><a href=\"#最近有个需求上传图片后，需要裁切图片，然后上传到阿里OSS服务器，这里记录一下封装的组件代码\" class=\"headerlink\" title=\"最近有个需求上传图片后，需要裁切图片，然后上传到阿里OSS服务器，这里记录一下封装的组件代码.\"></a>最近有个需求上传图片后，需要裁切图片，然后上传到阿里OSS服务器，这里记录一下封装的组件代码.</h3><p><img src=\"/images/imageCropper.gif\" alt=\"图片上传裁剪\"></p>\n<h4 id=\"最外层弹窗代码\"><a href=\"#最外层弹窗代码\" class=\"headerlink\" title=\"最外层弹窗代码\"></a>最外层弹窗代码</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &lt;div</span><br><span class=\"line\">      class=&quot;avatar-uploader&quot;</span><br><span class=\"line\">      :style=&quot;&#123;</span><br><span class=\"line\">        width: uploadConfig.width + &#x27;px&#x27;,</span><br><span class=\"line\">        height: uploadConfig.height + &#x27;px&#x27;</span><br><span class=\"line\">      &#125;&quot;</span><br><span class=\"line\">      @click=&quot;openDialog&quot;</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">      &lt;img v-if=&quot;imageUrl&quot; :src=&quot;imageUrl&quot; class=&quot;avatar&quot; /&gt;</span><br><span class=\"line\">      &lt;el-icon class=&quot;avatar-uploader-icon&quot;&gt;&lt;Plus /&gt;&lt;/el-icon&gt;</span><br><span class=\"line\">      &lt;div v-if=&quot;imageUrl&quot; class=&quot;avatar-uploader-info&quot;&gt;</span><br><span class=\"line\">        &lt;el-icon @click.stop=&quot;resetUpload&quot;&gt;&lt;Upload /&gt;&lt;/el-icon&gt;</span><br><span class=\"line\">        &lt;el-icon @click.stop=&quot;deleteImg&quot;&gt;&lt;Delete /&gt;&lt;/el-icon&gt;</span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">    &lt;Teleport to=&quot;body&quot;&gt;</span><br><span class=\"line\">      &lt;el-dialog</span><br><span class=\"line\">        v-model=&quot;dialogVisible&quot;</span><br><span class=\"line\">        title=&quot;裁剪图片&quot;</span><br><span class=\"line\">        width=&quot;45vw&quot;</span><br><span class=\"line\">        @open=&quot;onOpened&quot;</span><br><span class=\"line\">      &gt;</span><br><span class=\"line\">        &lt;p style=&quot;padding-left: 14px; font-size: 12px&quot;&gt;</span><br><span class=\"line\">          右键下方👇裁剪区可开启功能菜单</span><br><span class=\"line\">        &lt;/p&gt;</span><br><span class=\"line\">        &lt;div class=&quot;cropper-box&quot;&gt;</span><br><span class=\"line\">          &lt;ReCropper</span><br><span class=\"line\">            ref=&quot;refCropper&quot;</span><br><span class=\"line\">            :src=&quot;imgSrc&quot;</span><br><span class=\"line\">            :circled=&quot;circled&quot;</span><br><span class=\"line\">            :isClose=&quot;isClose&quot;</span><br><span class=\"line\">            :realTimePreview=&quot;realTimePreview&quot;</span><br><span class=\"line\">            :height=&quot;height&quot;</span><br><span class=\"line\">            :crossorigin=&quot;crossorigin&quot;</span><br><span class=\"line\">            :imageStyle=&quot;imageStyle&quot;</span><br><span class=\"line\">            :options=&quot;options&quot;</span><br><span class=\"line\">            @cropper=&quot;onCropper&quot;</span><br><span class=\"line\">            @readied=&quot;showPopoverHandle&quot;</span><br><span class=\"line\">            @cancel=&quot;onCancel&quot;</span><br><span class=\"line\">          /&gt;</span><br><span class=\"line\">          &lt;div</span><br><span class=\"line\">            v-if=&quot;showPopover&quot;</span><br><span class=\"line\">            class=&quot;cropper-current&quot;</span><br><span class=\"line\">            :style=&quot;&#123; height: height &#125;&quot;</span><br><span class=\"line\">          &gt;</span><br><span class=\"line\">            &lt;el-image</span><br><span class=\"line\">              v-if=&quot;cropperImg &amp;&amp; showPopover&quot;</span><br><span class=\"line\">              :src=&quot;cropperImg&quot;</span><br><span class=\"line\">              :preview-src-list=&quot;Array.of(cropperImg)&quot;</span><br><span class=\"line\">              fit=&quot;cover&quot;</span><br><span class=\"line\">            /&gt;</span><br><span class=\"line\">            &lt;div v-if=&quot;infos&quot; class=&quot;mt-1&quot;&gt;</span><br><span class=\"line\">              &lt;p&gt;</span><br><span class=\"line\">                图像大小：&#123;&#123; parseInt(infos.width) &#125;&#125; ×</span><br><span class=\"line\">                &#123;&#123; parseInt(infos.height) &#125;&#125;像素</span><br><span class=\"line\">              &lt;/p&gt;</span><br><span class=\"line\">              &lt;p&gt;</span><br><span class=\"line\">                文件大小：&#123;&#123; formatBytes(infos.size) &#125;&#125;（&#123;&#123; infos.size &#125;&#125; 字节）</span><br><span class=\"line\">              &lt;/p&gt;</span><br><span class=\"line\">            &lt;/div&gt;</span><br><span class=\"line\">          &lt;/div&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;template #footer&gt;</span><br><span class=\"line\">          &lt;div class=&quot;dialog-footer&quot;&gt;</span><br><span class=\"line\">            &lt;el-button @click=&quot;closeDialog&quot;&gt;取消&lt;/el-button&gt;</span><br><span class=\"line\">            &lt;el-button type=&quot;primary&quot; :disabled=&quot;isLoading&quot; @click=&quot;confirm&quot;&gt;</span><br><span class=\"line\">              提交</span><br><span class=\"line\">            &lt;/el-button&gt;</span><br><span class=\"line\">          &lt;/div&gt;</span><br><span class=\"line\">        &lt;/template&gt;</span><br><span class=\"line\">      &lt;/el-dialog&gt;</span><br><span class=\"line\">    &lt;/Teleport&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script setup&gt;</span><br><span class=\"line\">import &#123; ref, defineProps, watch &#125; from &quot;vue&quot;;</span><br><span class=\"line\">import ReCropper from &quot;../ReCropper&quot;;</span><br><span class=\"line\">import &#123; formatBytes &#125; from &quot;@pureadmin/utils&quot;;</span><br><span class=\"line\">import TaUploadApi from &quot;@/api/taUpload&quot;;</span><br><span class=\"line\">import &#123; message &#125; from &quot;@/utils/message&quot;;</span><br><span class=\"line\">import OSS from &quot;ali-oss&quot;;</span><br><span class=\"line\">const props = defineProps(&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">  crossorigin: &#123;</span><br><span class=\"line\">    type: String,</span><br><span class=\"line\">    default: &quot;anonymous&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">const imageUrl = ref(&quot;&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">const onCancel = () =&gt; &#123;</span><br><span class=\"line\">  closeDialog();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">const confirm = () =&gt; &#123;</span><br><span class=\"line\">  customUpload();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">// 获取剪裁后的图片信息</span><br><span class=\"line\">const onCropper = (&#123; base64, blob, info &#125;) =&gt; &#123;</span><br><span class=\"line\">  infos.value = info;</span><br><span class=\"line\">  cropperImg.value = base64;</span><br><span class=\"line\">  fileBlob.value = blob;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">// 获取OSS临时凭证</span><br><span class=\"line\">const getOSSCredentials = async () =&gt; &#123;</span><br><span class=\"line\">  try &#123;</span><br><span class=\"line\">    const &#123; credentials &#125; = await TaUploadApi.getOssToken(900);</span><br><span class=\"line\">    return credentials;</span><br><span class=\"line\">  &#125; catch (error) &#123;</span><br><span class=\"line\">    console.error(&quot;获取OSS凭证失败:&quot;, error);</span><br><span class=\"line\">    throw error;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">const customUpload = async () =&gt; &#123;</span><br><span class=\"line\">  try &#123;</span><br><span class=\"line\">    isLoading.value = true;</span><br><span class=\"line\">    // 动态获取OSS临时凭证</span><br><span class=\"line\">    const credentials = await getOSSCredentials();</span><br><span class=\"line\">    // 创建OSS客户端，添加自动刷新配置</span><br><span class=\"line\">    const client = new OSS(&#123;</span><br><span class=\"line\">      accessKeyId: credentials.accessKeyId,</span><br><span class=\"line\">      accessKeySecret: credentials.accessKeySecret,</span><br><span class=\"line\">      bucket: &quot;xxxx-cloud&quot;,</span><br><span class=\"line\">      // 自动刷新STS Token配置</span><br><span class=\"line\">      refreshSTSToken: async () =&gt; &#123;</span><br><span class=\"line\">        const newCredentials = await getOSSCredentials();</span><br><span class=\"line\">        return &#123;</span><br><span class=\"line\">          accessKeyId: newCredentials.accessKeyId,</span><br><span class=\"line\">          accessKeySecret: newCredentials.accessKeySecret,</span><br><span class=\"line\">          stsToken: newCredentials.securityToken</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      refreshSTSTokenInterval: 540_000, // 9分钟刷新一次</span><br><span class=\"line\">      region: &quot;xxxx&quot;,</span><br><span class=\"line\">      stsToken: credentials.securityToken</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    // 生成唯一文件名</span><br><span class=\"line\">    const fileName = `$&#123;Date.now()&#125;_$&#123;infos.value.file.name&#125;`;</span><br><span class=\"line\">    const result = await client.put(fileName, fileBlob.value);</span><br><span class=\"line\">    const &#123; url &#125; = result;</span><br><span class=\"line\">    if (url) &#123;</span><br><span class=\"line\">      imageUrl.value = url;</span><br><span class=\"line\">      message(&quot;图片上传成功&quot;, &#123; type: &quot;success&quot; &#125;);</span><br><span class=\"line\">      dialogVisible.value = false;</span><br><span class=\"line\">      emit(&quot;uploaded&quot;, url);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; catch (error) &#123;</span><br><span class=\"line\">    console.error(&quot;❌ OSS上传失败:&quot;, error);</span><br><span class=\"line\">    isLoading.value = false;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"上传并裁剪代码\"><a href=\"#上传并裁剪代码\" class=\"headerlink\" title=\"上传并裁剪代码\"></a>上传并裁剪代码</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div class=&quot;re-box&quot;&gt;</span><br><span class=\"line\">    &lt;ElUpload</span><br><span class=\"line\">      ref=&quot;uploadRef&quot;</span><br><span class=\"line\">      class=&quot;upload-style&quot;</span><br><span class=\"line\">      accept=&quot;image/*&quot;</span><br><span class=\"line\">      :show-file-list=&quot;false&quot;</span><br><span class=\"line\">      :before-upload=&quot;beforeUpload&quot;</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">      &lt;Upload</span><br><span class=\"line\">        v-tippy=&quot;&#123; content: &#x27;上传&#x27;, placement: &#x27;left-start&#x27; &#125;&quot;</span><br><span class=\"line\">        :class=&quot;&#123; iconClass &#125;&quot;</span><br><span class=\"line\">        @click=&quot;httpRequest&quot;</span><br><span class=\"line\">      /&gt;</span><br><span class=\"line\">    &lt;/ElUpload&gt;</span><br><span class=\"line\">    &lt;div</span><br><span class=\"line\">      v-if=&quot;inSrc&quot;</span><br><span class=\"line\">      ref=&quot;tippyElRef&quot;</span><br><span class=\"line\">      :class=&quot;&#123; &#x27;re-circled&#x27;: inCircled &#125;&quot;</span><br><span class=\"line\">      :style=&quot;wrapperStyle&quot;</span><br><span class=\"line\">      @contextmenu=&quot;onContextmenu&quot;</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">      &lt;img</span><br><span class=\"line\">        v-show=&quot;isReady&quot;</span><br><span class=\"line\">        ref=&quot;imgElRef&quot;</span><br><span class=\"line\">        :src=&quot;inSrc&quot;</span><br><span class=\"line\">        :alt=&quot;alt&quot;</span><br><span class=\"line\">        :style=&quot;imageStyle&quot;</span><br><span class=\"line\">      /&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script setup&gt;</span><br><span class=\"line\">import &#123;</span><br><span class=\"line\">  ref,</span><br><span class=\"line\">  computed,</span><br><span class=\"line\">  onMounted,</span><br><span class=\"line\">  onUnmounted,</span><br><span class=\"line\">  defineExpose,</span><br><span class=\"line\">  watch</span><br><span class=\"line\">&#125; from &quot;vue&quot;;</span><br><span class=\"line\">import Cropper from &quot;cropperjs&quot;;</span><br><span class=\"line\">import &#123; ElUpload &#125; from &quot;element-plus&quot;;</span><br><span class=\"line\">import &#123; useEventListener &#125; from &quot;@vueuse/core&quot;;</span><br><span class=\"line\">import &#123; useTippy &#125; from &quot;vue-tippy&quot;;</span><br><span class=\"line\">import &#123; delay, debounce, isArray, useResizeObserver &#125; from &quot;@pureadmin/utils&quot;;</span><br><span class=\"line\">import &#123; MenuContent &#125; from &quot;./MenuContent.js&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">const defaultOptions = &#123;</span><br><span class=\"line\">  aspectRatio: 1,</span><br><span class=\"line\">  zoomable: true,</span><br><span class=\"line\">  zoomOnTouch: true,</span><br><span class=\"line\">  zoomOnWheel: true,</span><br><span class=\"line\">  cropBoxMovable: true,</span><br><span class=\"line\">  cropBoxResizable: true,</span><br><span class=\"line\">  toggleDragModeOnDblclick: true,</span><br><span class=\"line\">  autoCrop: true,</span><br><span class=\"line\">  background: true,</span><br><span class=\"line\">  highlight: true,</span><br><span class=\"line\">  center: true,</span><br><span class=\"line\">  responsive: true,</span><br><span class=\"line\">  restore: true,</span><br><span class=\"line\">  checkCrossOrigin: true,</span><br><span class=\"line\">  checkOrientation: true,</span><br><span class=\"line\">  scalable: true,</span><br><span class=\"line\">  modal: true,</span><br><span class=\"line\">  guides: true,</span><br><span class=\"line\">  movable: true,</span><br><span class=\"line\">  rotatable: true</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">const props = defineProps(&#123;</span><br><span class=\"line\">  src: &#123; type: String, default: &quot;&quot; &#125;,</span><br><span class=\"line\">  alt: &#123; type: String &#125;,</span><br><span class=\"line\">  circled: &#123; type: Boolean, default: false &#125;,</span><br><span class=\"line\">  isClose: &#123; type: Boolean, default: true &#125;,</span><br><span class=\"line\">  realTimePreview: &#123; type: Boolean, default: true &#125;,</span><br><span class=\"line\">  height: &#123; type: [String, Number], default: &quot;260px&quot; &#125;,</span><br><span class=\"line\">  imageStyle: &#123; type: Object, default: () =&gt; (&#123;&#125;) &#125;,</span><br><span class=\"line\">  options: &#123; type: Object, default: () =&gt; (&#123;&#125;) &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">const emit = defineEmits([&quot;readied&quot;, &quot;cropper&quot;, &quot;error&quot;, &quot;cancel&quot;]);</span><br><span class=\"line\"></span><br><span class=\"line\">const tippyElRef = ref();</span><br><span class=\"line\">const imgElRef = ref();</span><br><span class=\"line\">const cropper = ref(null);</span><br><span class=\"line\">const inCircled = ref(props.circled);</span><br><span class=\"line\">const isInClose = ref(props.isClose);</span><br><span class=\"line\">const inSrc = ref(props.src);</span><br><span class=\"line\">const isReady = ref(false);</span><br><span class=\"line\">const imgBase64 = ref();</span><br><span class=\"line\">const uploadRef = ref(null);</span><br><span class=\"line\">const currentFile = ref(null);</span><br><span class=\"line\"></span><br><span class=\"line\">let scaleX = 1;</span><br><span class=\"line\">let scaleY = 1;</span><br><span class=\"line\"></span><br><span class=\"line\">const debounceRealTimeCroppered = debounce(realTimeCroppered, 80);</span><br><span class=\"line\"></span><br><span class=\"line\">const imageStyle = computed(() =&gt; (&#123;</span><br><span class=\"line\">  height: props.height,</span><br><span class=\"line\">  maxWidth: &quot;100%&quot;,</span><br><span class=\"line\">  ...props.imageStyle</span><br><span class=\"line\">&#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">watch(</span><br><span class=\"line\">  () =&gt; props.src,</span><br><span class=\"line\">  newVal =&gt; &#123;</span><br><span class=\"line\">    if (newVal) &#123;</span><br><span class=\"line\">      inSrc.value = newVal;</span><br><span class=\"line\"></span><br><span class=\"line\">      if (isReady.value) &#123;</span><br><span class=\"line\">        destroyCropper();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      setTimeout(() =&gt; &#123;</span><br><span class=\"line\">        init();</span><br><span class=\"line\">      &#125;, 0);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123; deep: true, immediate: true &#125;</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">const wrapperStyle = computed(() =&gt; (&#123;</span><br><span class=\"line\">  height: `$&#123;props.height&#125;`.replace(/px/, &quot;&quot;) + &quot;px&quot;</span><br><span class=\"line\">&#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">const iconClass =</span><br><span class=\"line\">  &quot;p-[6px] h-[30px] w-[30px] outline-hidden rounded-[4px] cursor-pointer hover:bg-[rgba(0,0,0,0.06)]&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">onMounted(() =&gt; &#123;</span><br><span class=\"line\">  init();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">onUnmounted(destroyCropper);</span><br><span class=\"line\"></span><br><span class=\"line\">useResizeObserver(tippyElRef, () =&gt; handCropper(&quot;reset&quot;, null));</span><br><span class=\"line\"></span><br><span class=\"line\">function init() &#123;</span><br><span class=\"line\">  const imgEl = imgElRef.value;</span><br><span class=\"line\">  if (!imgEl) return;</span><br><span class=\"line\"></span><br><span class=\"line\">  cropper.value = new Cropper(imgEl, &#123;</span><br><span class=\"line\">    ...defaultOptions,</span><br><span class=\"line\">    ...props.options,</span><br><span class=\"line\">    ready: () =&gt; &#123;</span><br><span class=\"line\">      isReady.value = true;</span><br><span class=\"line\">      realTimeCroppered();</span><br><span class=\"line\">      delay(400).then(() =&gt; emit(&quot;readied&quot;, cropper.value));</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    crop: debounceRealTimeCroppered,</span><br><span class=\"line\">    zoom: debounceRealTimeCroppered,</span><br><span class=\"line\">    cropmove: debounceRealTimeCroppered</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function destroyCropper() &#123;</span><br><span class=\"line\">  cropper.value?.destroy();</span><br><span class=\"line\">  isReady.value = false;</span><br><span class=\"line\">  cropper.value = null;</span><br><span class=\"line\">  imgBase64.value = &quot;&quot;;</span><br><span class=\"line\">  scaleX = 1;</span><br><span class=\"line\">  scaleY = 1;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function realTimeCroppered() &#123;</span><br><span class=\"line\">  props.realTimePreview &amp;&amp; croppered();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function croppered() &#123;</span><br><span class=\"line\">  if (!cropper.value) return;</span><br><span class=\"line\"></span><br><span class=\"line\">  const canvas = inCircled.value</span><br><span class=\"line\">    ? getRoundedCanvas()</span><br><span class=\"line\">    : cropper.value.getCroppedCanvas();</span><br><span class=\"line\"></span><br><span class=\"line\">  canvas.toBlob(blob =&gt; &#123;</span><br><span class=\"line\">    if (!blob) return;</span><br><span class=\"line\"></span><br><span class=\"line\">    const fileReader = new FileReader();</span><br><span class=\"line\">    fileReader.readAsDataURL(blob);</span><br><span class=\"line\">    fileReader.onloadend = e =&gt; &#123;</span><br><span class=\"line\">      if (!e.target?.result) return;</span><br><span class=\"line\">      imgBase64.value = e.target.result;</span><br><span class=\"line\">      emit(&quot;cropper&quot;, &#123;</span><br><span class=\"line\">        base64: e.target.result,</span><br><span class=\"line\">        blob,</span><br><span class=\"line\">        info: &#123;</span><br><span class=\"line\">          size: blob.size,</span><br><span class=\"line\">          ...cropper.value.getData(),</span><br><span class=\"line\">          file: currentFile.value</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    fileReader.onerror = () =&gt; emit(&quot;error&quot;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function getRoundedCanvas() &#123;</span><br><span class=\"line\">  const sourceCanvas = cropper.value.getCroppedCanvas();</span><br><span class=\"line\">  const canvas = document.createElement(&quot;canvas&quot;);</span><br><span class=\"line\">  const context = canvas.getContext(&quot;2d&quot;);</span><br><span class=\"line\">  const width = sourceCanvas.width;</span><br><span class=\"line\">  const height = sourceCanvas.height;</span><br><span class=\"line\"></span><br><span class=\"line\">  canvas.width = width;</span><br><span class=\"line\">  canvas.height = height;</span><br><span class=\"line\">  context.imageSmoothingEnabled = true;</span><br><span class=\"line\">  context.drawImage(sourceCanvas, 0, 0, width, height);</span><br><span class=\"line\">  context.globalCompositeOperation = &quot;destination-in&quot;;</span><br><span class=\"line\">  context.beginPath();</span><br><span class=\"line\">  context.arc(</span><br><span class=\"line\">    width / 2,</span><br><span class=\"line\">    height / 2,</span><br><span class=\"line\">    Math.min(width, height) / 2,</span><br><span class=\"line\">    0,</span><br><span class=\"line\">    2 * Math.PI,</span><br><span class=\"line\">    true</span><br><span class=\"line\">  );</span><br><span class=\"line\">  context.fill();</span><br><span class=\"line\"></span><br><span class=\"line\">  return canvas;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function handCropper(event, arg) &#123;</span><br><span class=\"line\">  if (event === &quot;scaleX&quot;) &#123;</span><br><span class=\"line\">    scaleX = arg = scaleX === -1 ? 1 : -1;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  if (event === &quot;scaleY&quot;) &#123;</span><br><span class=\"line\">    scaleY = arg = scaleY === -1 ? 1 : -1;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  arg &amp;&amp; isArray(arg)</span><br><span class=\"line\">    ? cropper.value?.[event]?.(...arg)</span><br><span class=\"line\">    : cropper.value?.[event]?.(arg);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function beforeUpload(file) &#123;</span><br><span class=\"line\">  const reader = new FileReader();</span><br><span class=\"line\">  reader.readAsDataURL(file);</span><br><span class=\"line\"></span><br><span class=\"line\">  inSrc.value = &quot;&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">  if (cropper.value) &#123;</span><br><span class=\"line\">    destroyCropper();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  reader.onload = e =&gt; &#123;</span><br><span class=\"line\">    if (e?.target?.result) &#123;</span><br><span class=\"line\">      inSrc.value = e.target.result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  currentFile.value = file;</span><br><span class=\"line\">  reader.onloadend = () =&gt; &#123;</span><br><span class=\"line\">    setTimeout(() =&gt; &#123;</span><br><span class=\"line\">      init();</span><br><span class=\"line\">    &#125;, 0);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  return false;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">const httpRequest = () =&gt; &#123;</span><br><span class=\"line\">  if (!uploadRef.value) return;</span><br><span class=\"line\">  const inputElement = uploadRef.value.$el.querySelector(&quot;input&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">  if (window._fileDialogTimer) &#123;</span><br><span class=\"line\">    clearInterval(window._fileDialogTimer);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  if (props.src &amp;&amp; !inSrc.value) &#123;</span><br><span class=\"line\">    inSrc.value = props.src;</span><br><span class=\"line\">    // 如果裁剪器未初始化，则初始化</span><br><span class=\"line\">    if (!cropper.value) &#123;</span><br><span class=\"line\">      setTimeout(() =&gt; &#123;</span><br><span class=\"line\">        init();</span><br><span class=\"line\">      &#125;, 0);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  const originalOnChange = inputElement.onchange;</span><br><span class=\"line\">  let fileHandled = false;</span><br><span class=\"line\"></span><br><span class=\"line\">  const checkCancel = () =&gt; &#123;</span><br><span class=\"line\">    setTimeout(() =&gt; &#123;</span><br><span class=\"line\">      if (!fileHandled) &#123;</span><br><span class=\"line\">        emit(&quot;cancel&quot;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      window.removeEventListener(&quot;focus&quot;, checkCancel);</span><br><span class=\"line\">    &#125;, 200);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  inputElement.onchange = event =&gt; &#123;</span><br><span class=\"line\">    fileHandled = true;</span><br><span class=\"line\">    if (originalOnChange) &#123;</span><br><span class=\"line\">      originalOnChange.call(inputElement, event);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">//这里检测不到点击文件上传取消按钮，用了检测页面是否失去焦点，如果失去焦点，则是取消上传，取消上传的话则直接关闭弹窗</span><br><span class=\"line\">  window.addEventListener(&quot;focus&quot;, checkCancel, &#123; once: true &#125;); </span><br><span class=\"line\">  inputElement.click();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">function onContextmenu(event) &#123;</span><br><span class=\"line\">  event.preventDefault();</span><br><span class=\"line\"></span><br><span class=\"line\">  const &#123; show, setProps, destroy, state &#125; = useTippy(tippyElRef, &#123;</span><br><span class=\"line\">    content: MenuContent(&#123;</span><br><span class=\"line\">      iconClass,</span><br><span class=\"line\">      beforeUpload,</span><br><span class=\"line\">      imgBase64,</span><br><span class=\"line\">      inCircled,</span><br><span class=\"line\">      realTimeCroppered,</span><br><span class=\"line\">      handCropper</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    arrow: false,</span><br><span class=\"line\">    theme: &quot;light&quot;,</span><br><span class=\"line\">    trigger: &quot;manual&quot;,</span><br><span class=\"line\">    interactive: true,</span><br><span class=\"line\">    appendTo: &quot;parent&quot;,</span><br><span class=\"line\">    placement: &quot;bottom-end&quot;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  setProps(&#123;</span><br><span class=\"line\">    getReferenceClientRect: () =&gt; (&#123;</span><br><span class=\"line\">      width: 0,</span><br><span class=\"line\">      height: 0,</span><br><span class=\"line\">      top: event.clientY,</span><br><span class=\"line\">      bottom: event.clientY,</span><br><span class=\"line\">      left: event.clientX,</span><br><span class=\"line\">      right: event.clientX</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  show();</span><br><span class=\"line\"></span><br><span class=\"line\">  if (isInClose.value) &#123;</span><br><span class=\"line\">    useEventListener(tippyElRef, &quot;click&quot;, destroy);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">defineExpose(&#123; httpRequest &#125;);</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">@import url(&quot;./circled.css&quot;);</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">&lt;style scoped&gt;</span><br><span class=\"line\">.re-box &#123;</span><br><span class=\"line\">  flex: 1 1 60%;</span><br><span class=\"line\">  max-width: 60%;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.re-circled &#123;</span><br><span class=\"line\">  overflow: hidden;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.upload-style &#123;</span><br><span class=\"line\">  position: fixed;</span><br><span class=\"line\">  right: -9999px;</span><br><span class=\"line\">  width: 0;</span><br><span class=\"line\">  height: 0;</span><br><span class=\"line\">  overflow: hidden;</span><br><span class=\"line\">  opacity: 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"自定义操作菜单，可重新上传、下载、旋转、放大缩小等操作\"><a href=\"#自定义操作菜单，可重新上传、下载、旋转、放大缩小等操作\" class=\"headerlink\" title=\"自定义操作菜单，可重新上传、下载、旋转、放大缩小等操作\"></a>自定义操作菜单，可重新上传、下载、旋转、放大缩小等操作</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; h &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;vue&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">ElUpload</span>, <span class=\"title class_\">ElTooltip</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;element-plus&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; downloadByBase64 &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;@pureadmin/utils&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">  <span class=\"title class_\">Reload</span>,</span><br><span class=\"line\">  <span class=\"title class_\">Upload</span>,</span><br><span class=\"line\">  <span class=\"title class_\">ArrowH</span>,</span><br><span class=\"line\">  <span class=\"title class_\">ArrowV</span>,</span><br><span class=\"line\">  <span class=\"title class_\">ArrowUp</span>,</span><br><span class=\"line\">  <span class=\"title class_\">ArrowDown</span>,</span><br><span class=\"line\">  <span class=\"title class_\">ArrowLeft</span>,</span><br><span class=\"line\">  <span class=\"title class_\">ChangeIcon</span>,</span><br><span class=\"line\">  <span class=\"title class_\">ArrowRight</span>,</span><br><span class=\"line\">  <span class=\"title class_\">RotateLeft</span>,</span><br><span class=\"line\">  <span class=\"title class_\">SearchPlus</span>,</span><br><span class=\"line\">  <span class=\"title class_\">RotateRight</span>,</span><br><span class=\"line\">  <span class=\"title class_\">SearchMinus</span>,</span><br><span class=\"line\">  <span class=\"title class_\">DownloadIcon</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;./svg&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">MenuContent</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  props = props || &#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">    iconClass,</span><br><span class=\"line\">    beforeUpload,</span><br><span class=\"line\">    imgBase64,</span><br><span class=\"line\">    inCircled,</span><br><span class=\"line\">    realTimeCroppered,</span><br><span class=\"line\">    handCropper</span><br><span class=\"line\">  &#125; = props;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title function_\">h</span>(<span class=\"string\">&quot;div&quot;</span>, &#123; <span class=\"attr\">class</span>: <span class=\"string\">&quot;flex flex-wrap w-[60px] justify-between&quot;</span> &#125;, [</span><br><span class=\"line\">    <span class=\"title function_\">h</span>(</span><br><span class=\"line\">      <span class=\"title class_\">ElUpload</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">accept</span>: <span class=\"string\">&quot;image/*&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;show-file-list&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;before-upload&quot;</span>: beforeUpload</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"function\">() =&gt;</span> [</span><br><span class=\"line\">        <span class=\"title function_\">h</span>(</span><br><span class=\"line\">          <span class=\"title class_\">ElTooltip</span>,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">content</span>: <span class=\"string\">&quot;上传&quot;</span>,</span><br><span class=\"line\">            <span class=\"attr\">placement</span>: <span class=\"string\">&quot;left-start&quot;</span></span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">              <span class=\"title function_\">h</span>(<span class=\"title class_\">Upload</span>, &#123;</span><br><span class=\"line\">                <span class=\"attr\">class</span>: iconClass</span><br><span class=\"line\">              &#125;)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        )</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"title function_\">h</span>(</span><br><span class=\"line\">      <span class=\"title class_\">ElTooltip</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">content</span>: <span class=\"string\">&quot;下载&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">placement</span>: <span class=\"string\">&quot;right-start&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">          <span class=\"title function_\">h</span>(<span class=\"title class_\">DownloadIcon</span>, &#123;</span><br><span class=\"line\">            <span class=\"attr\">class</span>: iconClass,</span><br><span class=\"line\">            <span class=\"attr\">onClick</span>: <span class=\"function\">() =&gt;</span> <span class=\"title function_\">downloadByBase64</span>(imgBase64.<span class=\"property\">value</span>, <span class=\"string\">&quot;cropping.png&quot;</span>)</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"title function_\">h</span>(</span><br><span class=\"line\">      <span class=\"title class_\">ElTooltip</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">content</span>: <span class=\"string\">&quot;圆形、矩形裁剪&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">placement</span>: <span class=\"string\">&quot;left-start&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">          <span class=\"title function_\">h</span>(<span class=\"title class_\">ChangeIcon</span>, &#123;</span><br><span class=\"line\">            <span class=\"attr\">class</span>: iconClass,</span><br><span class=\"line\">            <span class=\"attr\">onClick</span>: <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">              inCircled.<span class=\"property\">value</span> = !inCircled.<span class=\"property\">value</span>;</span><br><span class=\"line\">              <span class=\"title function_\">realTimeCroppered</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"title function_\">h</span>(</span><br><span class=\"line\">      <span class=\"title class_\">ElTooltip</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">content</span>: <span class=\"string\">&quot;重置&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">placement</span>: <span class=\"string\">&quot;right-start&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">          <span class=\"title function_\">h</span>(<span class=\"title class_\">Reload</span>, &#123;</span><br><span class=\"line\">            <span class=\"attr\">class</span>: iconClass,</span><br><span class=\"line\">            <span class=\"attr\">onClick</span>: <span class=\"function\">() =&gt;</span> <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;reset&quot;</span>)</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"title function_\">h</span>(</span><br><span class=\"line\">      <span class=\"title class_\">ElTooltip</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">content</span>: <span class=\"string\">&quot;上移（可长按）&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">placement</span>: <span class=\"string\">&quot;left-start&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">          <span class=\"title function_\">h</span>(<span class=\"title class_\">ArrowUp</span>, &#123;</span><br><span class=\"line\">            <span class=\"attr\">class</span>: iconClass,</span><br><span class=\"line\">            <span class=\"attr\">onClick</span>: <span class=\"function\">() =&gt;</span> <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;move&quot;</span>, [<span class=\"number\">0</span>, -<span class=\"number\">10</span>]),</span><br><span class=\"line\">            <span class=\"attr\">onMousedown</span>: <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">              e.<span class=\"title function_\">preventDefault</span>();</span><br><span class=\"line\">              <span class=\"keyword\">const</span> timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> interval = <span class=\"built_in\">setInterval</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                  <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;move&quot;</span>, [<span class=\"number\">0</span>, -<span class=\"number\">10</span>]);</span><br><span class=\"line\">                &#125;, <span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">const</span> <span class=\"title function_\">clearTimers</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">                  <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">                  <span class=\"built_in\">clearInterval</span>(interval);</span><br><span class=\"line\">                  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, clearTimers);</span><br><span class=\"line\">                  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&quot;mouseleave&quot;</span>, clearTimers);</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, clearTimers);</span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseleave&quot;</span>, clearTimers);</span><br><span class=\"line\">              &#125;, <span class=\"number\">500</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, <span class=\"function\">() =&gt;</span> <span class=\"built_in\">clearTimeout</span>(timer));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"title function_\">h</span>(</span><br><span class=\"line\">      <span class=\"title class_\">ElTooltip</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">content</span>: <span class=\"string\">&quot;下移（可长按）&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">placement</span>: <span class=\"string\">&quot;right-start&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">          <span class=\"title function_\">h</span>(<span class=\"title class_\">ArrowDown</span>, &#123;</span><br><span class=\"line\">            <span class=\"attr\">class</span>: iconClass,</span><br><span class=\"line\">            <span class=\"attr\">onClick</span>: <span class=\"function\">() =&gt;</span> <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;move&quot;</span>, [<span class=\"number\">0</span>, <span class=\"number\">10</span>]),</span><br><span class=\"line\">            <span class=\"attr\">onMousedown</span>: <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">              e.<span class=\"title function_\">preventDefault</span>();</span><br><span class=\"line\">              <span class=\"keyword\">const</span> timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> interval = <span class=\"built_in\">setInterval</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                  <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;move&quot;</span>, [<span class=\"number\">0</span>, <span class=\"number\">10</span>]);</span><br><span class=\"line\">                &#125;, <span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">const</span> <span class=\"title function_\">clearTimers</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">                  <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">                  <span class=\"built_in\">clearInterval</span>(interval);</span><br><span class=\"line\">                  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, clearTimers);</span><br><span class=\"line\">                  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&quot;mouseleave&quot;</span>, clearTimers);</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, clearTimers);</span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseleave&quot;</span>, clearTimers);</span><br><span class=\"line\">              &#125;, <span class=\"number\">500</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, <span class=\"function\">() =&gt;</span> <span class=\"built_in\">clearTimeout</span>(timer));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"title function_\">h</span>(</span><br><span class=\"line\">      <span class=\"title class_\">ElTooltip</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">content</span>: <span class=\"string\">&quot;左移（可长按）&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">placement</span>: <span class=\"string\">&quot;left-start&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">          <span class=\"title function_\">h</span>(<span class=\"title class_\">ArrowLeft</span>, &#123;</span><br><span class=\"line\">            <span class=\"attr\">class</span>: iconClass,</span><br><span class=\"line\">            <span class=\"attr\">onClick</span>: <span class=\"function\">() =&gt;</span> <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;move&quot;</span>, [-<span class=\"number\">10</span>, <span class=\"number\">0</span>]),</span><br><span class=\"line\">            <span class=\"attr\">onMousedown</span>: <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">              e.<span class=\"title function_\">preventDefault</span>();</span><br><span class=\"line\">              <span class=\"keyword\">const</span> timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> interval = <span class=\"built_in\">setInterval</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                  <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;move&quot;</span>, [-<span class=\"number\">10</span>, <span class=\"number\">0</span>]);</span><br><span class=\"line\">                &#125;, <span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">const</span> <span class=\"title function_\">clearTimers</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">                  <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">                  <span class=\"built_in\">clearInterval</span>(interval);</span><br><span class=\"line\">                  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, clearTimers);</span><br><span class=\"line\">                  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&quot;mouseleave&quot;</span>, clearTimers);</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, clearTimers);</span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseleave&quot;</span>, clearTimers);</span><br><span class=\"line\">              &#125;, <span class=\"number\">500</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, <span class=\"function\">() =&gt;</span> <span class=\"built_in\">clearTimeout</span>(timer));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"title function_\">h</span>(</span><br><span class=\"line\">      <span class=\"title class_\">ElTooltip</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">content</span>: <span class=\"string\">&quot;右移（可长按）&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">placement</span>: <span class=\"string\">&quot;right-start&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">          <span class=\"title function_\">h</span>(<span class=\"title class_\">ArrowRight</span>, &#123;</span><br><span class=\"line\">            <span class=\"attr\">class</span>: iconClass,</span><br><span class=\"line\">            <span class=\"attr\">onClick</span>: <span class=\"function\">() =&gt;</span> <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;move&quot;</span>, [<span class=\"number\">10</span>, <span class=\"number\">0</span>]),</span><br><span class=\"line\">            <span class=\"attr\">onMousedown</span>: <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">              e.<span class=\"title function_\">preventDefault</span>();</span><br><span class=\"line\">              <span class=\"keyword\">const</span> timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> interval = <span class=\"built_in\">setInterval</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                  <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;move&quot;</span>, [<span class=\"number\">10</span>, <span class=\"number\">0</span>]);</span><br><span class=\"line\">                &#125;, <span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">const</span> <span class=\"title function_\">clearTimers</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">                  <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">                  <span class=\"built_in\">clearInterval</span>(interval);</span><br><span class=\"line\">                  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, clearTimers);</span><br><span class=\"line\">                  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&quot;mouseleave&quot;</span>, clearTimers);</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, clearTimers);</span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseleave&quot;</span>, clearTimers);</span><br><span class=\"line\">              &#125;, <span class=\"number\">500</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, <span class=\"function\">() =&gt;</span> <span class=\"built_in\">clearTimeout</span>(timer));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"title function_\">h</span>(</span><br><span class=\"line\">      <span class=\"title class_\">ElTooltip</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">content</span>: <span class=\"string\">&quot;水平翻转&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">placement</span>: <span class=\"string\">&quot;left-start&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">          <span class=\"title function_\">h</span>(<span class=\"title class_\">ArrowH</span>, &#123;</span><br><span class=\"line\">            <span class=\"attr\">class</span>: iconClass,</span><br><span class=\"line\">            <span class=\"attr\">onClick</span>: <span class=\"function\">() =&gt;</span> <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;scaleX&quot;</span>, -<span class=\"number\">1</span>)</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"title function_\">h</span>(</span><br><span class=\"line\">      <span class=\"title class_\">ElTooltip</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">content</span>: <span class=\"string\">&quot;垂直翻转&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">placement</span>: <span class=\"string\">&quot;right-start&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">          <span class=\"title function_\">h</span>(<span class=\"title class_\">ArrowV</span>, &#123;</span><br><span class=\"line\">            <span class=\"attr\">class</span>: iconClass,</span><br><span class=\"line\">            <span class=\"attr\">onClick</span>: <span class=\"function\">() =&gt;</span> <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;scaleY&quot;</span>, -<span class=\"number\">1</span>)</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"title function_\">h</span>(</span><br><span class=\"line\">      <span class=\"title class_\">ElTooltip</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">content</span>: <span class=\"string\">&quot;逆时针旋转&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">placement</span>: <span class=\"string\">&quot;left-start&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">          <span class=\"title function_\">h</span>(<span class=\"title class_\">RotateLeft</span>, &#123;</span><br><span class=\"line\">            <span class=\"attr\">class</span>: iconClass,</span><br><span class=\"line\">            <span class=\"attr\">onClick</span>: <span class=\"function\">() =&gt;</span> <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;rotate&quot;</span>, -<span class=\"number\">45</span>)</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"title function_\">h</span>(</span><br><span class=\"line\">      <span class=\"title class_\">ElTooltip</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">content</span>: <span class=\"string\">&quot;顺时针旋转&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">placement</span>: <span class=\"string\">&quot;right-start&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">          <span class=\"title function_\">h</span>(<span class=\"title class_\">RotateRight</span>, &#123;</span><br><span class=\"line\">            <span class=\"attr\">class</span>: iconClass,</span><br><span class=\"line\">            <span class=\"attr\">onClick</span>: <span class=\"function\">() =&gt;</span> <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;rotate&quot;</span>, <span class=\"number\">45</span>)</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"title function_\">h</span>(</span><br><span class=\"line\">      <span class=\"title class_\">ElTooltip</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">content</span>: <span class=\"string\">&quot;放大（可长按）&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">placement</span>: <span class=\"string\">&quot;left-start&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">          <span class=\"title function_\">h</span>(<span class=\"title class_\">SearchPlus</span>, &#123;</span><br><span class=\"line\">            <span class=\"attr\">class</span>: iconClass,</span><br><span class=\"line\">            <span class=\"attr\">onClick</span>: <span class=\"function\">() =&gt;</span> <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;zoom&quot;</span>, <span class=\"number\">0.1</span>),</span><br><span class=\"line\">            <span class=\"attr\">onMousedown</span>: <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">              e.<span class=\"title function_\">preventDefault</span>();</span><br><span class=\"line\">              <span class=\"keyword\">const</span> timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> interval = <span class=\"built_in\">setInterval</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                  <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;zoom&quot;</span>, <span class=\"number\">0.1</span>);</span><br><span class=\"line\">                &#125;, <span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">const</span> <span class=\"title function_\">clearTimers</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">                  <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">                  <span class=\"built_in\">clearInterval</span>(interval);</span><br><span class=\"line\">                  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, clearTimers);</span><br><span class=\"line\">                  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&quot;mouseleave&quot;</span>, clearTimers);</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, clearTimers);</span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseleave&quot;</span>, clearTimers);</span><br><span class=\"line\">              &#125;, <span class=\"number\">500</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, <span class=\"function\">() =&gt;</span> <span class=\"built_in\">clearTimeout</span>(timer));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"title function_\">h</span>(</span><br><span class=\"line\">      <span class=\"title class_\">ElTooltip</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">content</span>: <span class=\"string\">&quot;缩小（可长按）&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">placement</span>: <span class=\"string\">&quot;right-start&quot;</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">default</span>: <span class=\"function\">() =&gt;</span></span><br><span class=\"line\">          <span class=\"title function_\">h</span>(<span class=\"title class_\">SearchMinus</span>, &#123;</span><br><span class=\"line\">            <span class=\"attr\">class</span>: iconClass,</span><br><span class=\"line\">            <span class=\"attr\">onClick</span>: <span class=\"function\">() =&gt;</span> <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;zoom&quot;</span>, -<span class=\"number\">0.1</span>),</span><br><span class=\"line\">            <span class=\"attr\">onMousedown</span>: <span class=\"function\"><span class=\"params\">e</span> =&gt;</span> &#123;</span><br><span class=\"line\">              e.<span class=\"title function_\">preventDefault</span>();</span><br><span class=\"line\">              <span class=\"keyword\">const</span> timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> interval = <span class=\"built_in\">setInterval</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                  <span class=\"title function_\">handCropper</span>(<span class=\"string\">&quot;zoom&quot;</span>, -<span class=\"number\">0.1</span>);</span><br><span class=\"line\">                &#125;, <span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">const</span> <span class=\"title function_\">clearTimers</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">                  <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">                  <span class=\"built_in\">clearInterval</span>(interval);</span><br><span class=\"line\">                  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, clearTimers);</span><br><span class=\"line\">                  <span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&quot;mouseleave&quot;</span>, clearTimers);</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, clearTimers);</span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseleave&quot;</span>, clearTimers);</span><br><span class=\"line\">              &#125;, <span class=\"number\">500</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;mouseup&quot;</span>, <span class=\"function\">() =&gt;</span> <span class=\"built_in\">clearTimeout</span>(timer));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\">  ]);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","text":"二次封装图片裁切组件最近有个需求上传图片后，需要裁切图片，然后上传到阿里OSS服务器，这里记录一下封装的组件代码. 最外层弹窗代码<template> <div...","permalink":"/post/imageCropper","photos":[],"count_time":{"symbolsCount":"25k","symbolsTime":"23 mins."},"categories":[{"name":"vue3","slug":"vue3","count":2,"path":"api/categories/vue3.json"},{"name":"element-plus","slug":"vue3/element-plus","count":1,"path":"api/categories/vue3/element-plus.json"}],"tags":[{"name":"components","slug":"components","count":4,"path":"api/tags/components.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E6%AC%A1%E5%B0%81%E8%A3%85%E5%9B%BE%E7%89%87%E8%A3%81%E5%88%87%E7%BB%84%E4%BB%B6\"><span class=\"toc-text\">二次封装图片裁切组件</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%80%E8%BF%91%E6%9C%89%E4%B8%AA%E9%9C%80%E6%B1%82%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E5%90%8E%EF%BC%8C%E9%9C%80%E8%A6%81%E8%A3%81%E5%88%87%E5%9B%BE%E7%89%87%EF%BC%8C%E7%84%B6%E5%90%8E%E4%B8%8A%E4%BC%A0%E5%88%B0%E9%98%BF%E9%87%8COSS%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E8%BF%99%E9%87%8C%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8B%E5%B0%81%E8%A3%85%E7%9A%84%E7%BB%84%E4%BB%B6%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">最近有个需求上传图片后，需要裁切图片，然后上传到阿里OSS服务器，这里记录一下封装的组件代码.</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9C%80%E5%A4%96%E5%B1%82%E5%BC%B9%E7%AA%97%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">最外层弹窗代码</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%B8%8A%E4%BC%A0%E5%B9%B6%E8%A3%81%E5%89%AA%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">上传并裁剪代码</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%93%8D%E4%BD%9C%E8%8F%9C%E5%8D%95%EF%BC%8C%E5%8F%AF%E9%87%8D%E6%96%B0%E4%B8%8A%E4%BC%A0%E3%80%81%E4%B8%8B%E8%BD%BD%E3%80%81%E6%97%8B%E8%BD%AC%E3%80%81%E6%94%BE%E5%A4%A7%E7%BC%A9%E5%B0%8F%E7%AD%89%E6%93%8D%E4%BD%9C\"><span class=\"toc-text\">自定义操作菜单，可重新上传、下载、旋转、放大缩小等操作</span></a></li></ol></li></ol></li></ol>","author":{"name":"M","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"这是我的博客","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"vue-plugin-print使用记录","uid":"474c43179da4f2cf19115611e6d2dd7f","slug":"print","date":"2025-09-06T12:21:09.000Z","updated":"2025-09-19T06:08:22.303Z","comments":true,"path":"api/articles/print.json","keywords":null,"cover":"/images/cover1.jpg","text":"最近后台管理新增一个可视化编辑器并可以打印的功能，调研了 hiprint，不过后面发现了有位大佬用 hiprint 二次开发了 vue 插件，经过调研使用了 v...","permalink":"/post/print","photos":[],"count_time":{"symbolsCount":"18k","symbolsTime":"16 mins."},"categories":[{"name":"vue3","slug":"vue3","count":2,"path":"api/categories/vue3.json"}],"tags":[{"name":"tools","slug":"tools","count":4,"path":"api/tags/tools.json"}],"author":{"name":"M","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"这是我的博客","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"gasp滚动动画插件","uid":"1a4fe8e70141b1d330581e14c7420257","slug":"gasp","date":"2025-05-16T07:08:38.000Z","updated":"2025-09-18T07:27:55.630Z","comments":true,"path":"api/articles/gasp.json","keywords":null,"cover":"/images/cover1.jpg","text":"最近无意间看到了scrollTrigger滚动插件，很有兴趣，就研究了一下这个插件，这里记录一下模仿oppo官网的动画效果文字随滚动条进度渐变参考https:/...","permalink":"/post/gasp","photos":[],"count_time":{"symbolsCount":"14k","symbolsTime":"13 mins."},"categories":[{"name":"javascript","slug":"javascript","count":8,"path":"api/categories/javascript.json"}],"tags":[{"name":"animation","slug":"animation","count":3,"path":"api/tags/animation.json"}],"author":{"name":"M","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"这是我的博客","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}