{"title":"vue-plugin-print使用记录","uid":"474c43179da4f2cf19115611e6d2dd7f","slug":"print","date":"2025-09-06T12:21:09.000Z","updated":"2025-09-19T06:08:22.303Z","comments":true,"path":"api/articles/print.json","keywords":null,"cover":"/images/cover1.jpg","content":"<p>最近后台管理新增一个可视化编辑器并可以打印的功能，调研了 hiprint，不过后面发现了有位大佬用 hiprint 二次开发了 vue 插件，经过调研使用了 vue-plugin-print 这个插件，记录一下使用过程。</p>\n<p><a href=\"http://hiprint.io/\">hiprint 官网</a></p>\n<p><a href=\"https://gitee.com/CcSimple/vue-plugin-hiprint\">vue-plugin-print</a></p>\n<h2 id=\"基本设计器\"><a href=\"#基本设计器\" class=\"headerlink\" title=\"基本设计器\"></a>基本设计器</h2><p>具体安装方法和 api 可以参考官网，这里只是记录一下我自己的使用过程。</p>\n<p>我是用 vue3 + element-plus 写的，左侧设计器是有动态的，也有写死的基本设计元素，具体的实现如下</p>\n<p>首先定义基础设计器的数据，我这里是写死的，tid 是一定需要的且不要重复，否则无法拖拽，title 是显示的名称，type 是类型，options 是配置项，这里的配置项是根据 type 来定义的，具体的配置项可以参考官网，这里我只写了部分，其他的可以参考官网。</p>\n<p>这里也可以定义 field，这个是字段名，后续预览或者打印可以根据字段名替换真实数据，如果不定义 field，则会用 title 作为数据。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> basicData = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">tid</span>: <span class=\"string\">&quot;providerModule.customText&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&quot;文本&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">width</span>: <span class=\"number\">100</span>,</span><br><span class=\"line\">    <span class=\"attr\">height</span>: <span class=\"number\">21</span>,</span><br><span class=\"line\">    <span class=\"attr\">custom</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">customText</span>: <span class=\"string\">&quot;自定义文本&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">21</span>,</span><br><span class=\"line\">      <span class=\"attr\">fontSize</span>: <span class=\"number\">15</span>,</span><br><span class=\"line\">      <span class=\"attr\">lineHeight</span>: <span class=\"number\">21</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">tid</span>: <span class=\"string\">&quot;providerModule.longText&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&quot;长文本&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">&quot;longText&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"number\">200</span>,</span><br><span class=\"line\">      <span class=\"attr\">fontSize</span>: <span class=\"number\">15</span>,</span><br><span class=\"line\">      <span class=\"attr\">lineHeight</span>: <span class=\"number\">21</span>,</span><br><span class=\"line\">      <span class=\"attr\">testData</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">tid</span>: <span class=\"string\">&quot;providerModule.barcode&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&quot;条形码&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">&quot;barcode&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">64</span>,</span><br><span class=\"line\">      <span class=\"attr\">fontSize</span>: <span class=\"number\">12</span>,</span><br><span class=\"line\">      <span class=\"attr\">lineHeight</span>: <span class=\"number\">18</span>,</span><br><span class=\"line\">      <span class=\"attr\">textAlign</span>: <span class=\"string\">&quot;center&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">textType</span>: <span class=\"string\">&quot;barcode&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">hideTitle</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">tid</span>: <span class=\"string\">&quot;providerModule.qrcode&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&quot;二维码&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">&quot;qrcode&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">128</span>,</span><br><span class=\"line\">      <span class=\"attr\">fontSize</span>: <span class=\"number\">10</span>,</span><br><span class=\"line\">      <span class=\"attr\">lineHeight</span>: <span class=\"number\">18</span>,</span><br><span class=\"line\">      <span class=\"attr\">textType</span>: <span class=\"string\">&quot;qrcode&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">hideTitle</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">tid</span>: <span class=\"string\">&quot;providerModule.image&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&quot;图片&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">&quot;image&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"number\">64</span>,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">64</span>,</span><br><span class=\"line\">      <span class=\"attr\">field</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">src</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">      <span class=\"attr\">hideTitle</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">tid</span>: <span class=\"string\">&quot;providerModule.hline&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&quot;横线&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">&quot;hline&quot;</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">tid</span>: <span class=\"string\">&quot;providerModule.vline&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&quot;竖线&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">&quot;vline&quot;</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">tid</span>: <span class=\"string\">&quot;providerModule.rect&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&quot;矩形&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">&quot;rect&quot;</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">tid</span>: <span class=\"string\">&quot;providerModule.oval&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&quot;椭圆&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">&quot;oval&quot;</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> basicData;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; hiprint &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;vue-plugin-hiprint&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">// 这里moduleKey是tid的开头前缀</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> createProviderBasic = <span class=\"keyword\">function</span> (<span class=\"params\">options, moduleKey = <span class=\"string\">&quot;providerModule&quot;</span></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> addElementTypes = <span class=\"keyword\">function</span> (<span class=\"params\">context</span>) &#123;</span><br><span class=\"line\">    context.<span class=\"title function_\">removePrintElementTypes</span>(moduleKey);</span><br><span class=\"line\">    context.<span class=\"title function_\">addPrintElementTypes</span>(moduleKey, [</span><br><span class=\"line\">      <span class=\"keyword\">new</span> hiprint.<span class=\"title class_\">PrintElementTypeGroup</span>(<span class=\"string\">&quot;&quot;</span>, options),</span><br><span class=\"line\">    ]);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">addElementTypes</span>: addElementTypes,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>然后是初始化设计器,这里我是用的 element-plus 的 el-menu 组件,结构无所谓，看自己需求就好。</p>\n<p>注意定义的设计器一定要加 <code>ep-draggable-item</code> 这个类名，否则无法找到拖拽元素无法拖拽</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;el-menu class=&quot;content-bottom-left&quot; :default-openeds=&quot;[&#x27;1&#x27;]&quot;&gt;</span><br><span class=\"line\">    &lt;el-sub-menu index=&quot;2&quot;&gt;</span><br><span class=\"line\">      &lt;template #title&gt;</span><br><span class=\"line\">        &lt;el-icon&gt;&lt;FolderOpened /&gt;&lt;/el-icon&gt;</span><br><span class=\"line\">        &lt;span&gt;基础元素&lt;/span&gt;</span><br><span class=\"line\">      &lt;/template&gt;</span><br><span class=\"line\">      &lt;el-menu-item</span><br><span class=\"line\">        v-for=&quot;item in basicData&quot;</span><br><span class=\"line\">        :key=&quot;item&quot;</span><br><span class=\"line\">        class=&quot;ep-draggable-item item&quot;</span><br><span class=\"line\">        :tid=&quot;item.tid&quot;</span><br><span class=\"line\">        :index=&quot;&#x27;2-&#x27; + item.tid&quot;</span><br><span class=\"line\">      &gt;</span><br><span class=\"line\">        &lt;el-icon&gt;&lt;Tools /&gt;&lt;/el-icon&gt;</span><br><span class=\"line\">        &lt;span&gt;&#123;&#123; item.title &#125;&#125;&lt;/span&gt;&lt;/el-menu-item</span><br><span class=\"line\">      &gt;</span><br><span class=\"line\">    &lt;/el-sub-menu&gt;</span><br><span class=\"line\">  &lt;/el-menu&gt;</span><br><span class=\"line\">  &lt;!-- 这里是打印设计器 --&gt;</span><br><span class=\"line\">   &lt;div class=&quot;overflow-auto item-print&quot;&gt;</span><br><span class=\"line\">        &lt;div id=&quot;hiprint-printTemplate&quot; /&gt;</span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">      &lt;!-- 这里是打印参数设置 --&gt;</span><br><span class=\"line\">      &lt;div class=&quot;overflow-auto item-el&quot;&gt;</span><br><span class=\"line\">        &lt;div id=&quot;print-element-option-setting&quot; /&gt;</span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\">&lt;script setup&gt;</span><br><span class=\"line\">import &#123; ref, onMounted &#125; from &quot;vue&quot;;</span><br><span class=\"line\">import &#123; hiprint &#125; from &quot;vue-plugin-hiprint&quot;;</span><br><span class=\"line\">import basicData from &quot;./basicData&quot;;</span><br><span class=\"line\">import &#123; createProviderBasic &#125; from &quot;./utils/provider&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">//初始化基础设计器</span><br><span class=\"line\">hiprint.init(&#123;</span><br><span class=\"line\">    providers: [</span><br><span class=\"line\">        createProviderBasic(basicData),</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">onMounted(() =&gt; &#123;</span><br><span class=\"line\">  buildDesigner()</span><br><span class=\"line\">  buildLeftElement();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">const buildLeftElement = () =&gt; &#123;</span><br><span class=\"line\">  hiprint.PrintElementTypeManager.buildByHtml($(&quot;.ep-draggable-item&quot;));</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">let hiprintTemplate;</span><br><span class=\"line\">const buildDesigner = () =&gt; &#123;</span><br><span class=\"line\">  $(&quot;#hiprint-printTemplate&quot;).empty(); // 先清空, 避免重复构建</span><br><span class=\"line\">  hiprintTemplate = new hiprint.PrintTemplate(&#123;</span><br><span class=\"line\">    settingContainer: &quot;#print-element-option-setting&quot;, // 元素参数容器</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  // 构建 并填充到 容器中</span><br><span class=\"line\">  hiprintTemplate.design(&quot;#hiprint-printTemplate&quot;, &#123;</span><br><span class=\"line\">    grid: true //可以设置网格化</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>这样就初始化完成了基础设计器，效果如下</p>\n<img src=\"/images/basic.gif\" width=\"500\" height=\"300\">\n\n<p>基础元素里有还有图片设计器，除了可以写死 src 地址外，还可以直接赋值链接地址填入，还可以自己上传图片</p>\n<p>手动上传图片的话，需要在初始化的时候，添加 onImageChooseClick 点击事件，否则点击按钮无反应</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">hiprintTemplate = <span class=\"keyword\">new</span> hiprint.<span class=\"title class_\">PrintTemplate</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">settingContainer</span>: <span class=\"string\">&quot;#print-element-option-setting&quot;</span>, <span class=\"comment\">// 元素参数容器</span></span><br><span class=\"line\">  <span class=\"comment\">// 监听图片选择事</span></span><br><span class=\"line\">  <span class=\"attr\">onImageChooseClick</span>: <span class=\"function\">(<span class=\"params\">target</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> input = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;input&quot;</span>);</span><br><span class=\"line\">    input.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&quot;type&quot;</span>, <span class=\"string\">&quot;file&quot;</span>);</span><br><span class=\"line\">    input.<span class=\"title function_\">click</span>();</span><br><span class=\"line\">    input.<span class=\"property\">onchange</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> file = <span class=\"variable language_\">this</span>.<span class=\"property\">files</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\">      <span class=\"keyword\">var</span> reader = <span class=\"keyword\">new</span> <span class=\"title class_\">FileReader</span>();</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (file) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> reader = <span class=\"keyword\">new</span> <span class=\"title class_\">FileReader</span>();</span><br><span class=\"line\">        reader.<span class=\"title function_\">readAsDataURL</span>(file);</span><br><span class=\"line\">        reader.<span class=\"property\">onloadend</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">          target.<span class=\"title function_\">refresh</span>(reader.<span class=\"property\">result</span>);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    input.<span class=\"title function_\">remove</span>();</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<img src=\"/images/basicImage.gif\" width=\"500\" height=\"300\">\n\n<h2 id=\"动态获取设计器\"><a href=\"#动态获取设计器\" class=\"headerlink\" title=\"动态获取设计器\"></a>动态获取设计器</h2><p>除了上面说的基础设计器外，还可以根据后台接口动态获取设计器。</p>\n<p>因为接口数据结构是不一样的，后端返回的数据并不一定满足 hiprint 的数据结构，所以需要自己转换处理一下。</p>\n<p>这里我写了一个简单的转换函数，因为要做成 el-menu 的形式，并且如果当前数据关联了其它表，还需要可以展开的第二层所以这里处理一下元素加个 children，</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// formatTableData.js</span></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 根据字段类型获取打印元素类型和选项</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; <span class=\"variable\">fieldType</span> - 字段类型</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Object</span>&#125; <span class=\"variable\">baseOptions</span> - 基础选项</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">Object</span>&#125; - 包含类型和选项的对象</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">getTypeAndOptions</span> = (<span class=\"params\">fieldType, baseOptions, item, field = &#123;&#125;</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> type = <span class=\"string\">&quot;text&quot;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> options = &#123; ...baseOptions &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 根据字段类型设置特殊配置</span></span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (fieldType) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&quot;sub_table&quot;</span>:</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (field.<span class=\"property\">fieldCode</span>) &#123;</span><br><span class=\"line\">        type = <span class=\"string\">&quot;text&quot;</span>;</span><br><span class=\"line\">        options = &#123;</span><br><span class=\"line\">          ...options,</span><br><span class=\"line\">          <span class=\"attr\">width</span>: <span class=\"number\">200</span>,</span><br><span class=\"line\">          <span class=\"attr\">height</span>: <span class=\"number\">21</span>,</span><br><span class=\"line\">          <span class=\"attr\">field</span>: field.<span class=\"property\">fieldCode</span> ? <span class=\"string\">`<span class=\"subst\">$&#123;field.fieldCode&#125;</span>`</span> : item.<span class=\"property\">fieldCode</span>,</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        type = <span class=\"string\">&quot;table&quot;</span>;</span><br><span class=\"line\">        options = &#123;</span><br><span class=\"line\">          ...options,</span><br><span class=\"line\">          <span class=\"attr\">fontSize</span>: <span class=\"number\">12</span>,</span><br><span class=\"line\">          <span class=\"attr\">lineHeight</span>: <span class=\"number\">24</span>,</span><br><span class=\"line\">          <span class=\"attr\">height</span>: <span class=\"number\">60</span>,</span><br><span class=\"line\">          <span class=\"attr\">tableHeaderFontWeight</span>: <span class=\"string\">&quot;bold&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">tableBodyRowHeight</span>: <span class=\"number\">20</span>,</span><br><span class=\"line\">          <span class=\"attr\">tableHeaderBackground</span>: <span class=\"string\">&quot; rgb(233, 233, 235)&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">field</span>: field.<span class=\"property\">fieldCode</span> ? <span class=\"string\">`<span class=\"subst\">$&#123;field.fieldCode&#125;</span>`</span> : item.<span class=\"property\">fieldCode</span>,</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"attr\">default</span>:</span><br><span class=\"line\">      type = <span class=\"string\">&quot;text&quot;</span>;</span><br><span class=\"line\">      options = &#123;</span><br><span class=\"line\">        ...options,</span><br><span class=\"line\">        <span class=\"attr\">width</span>: <span class=\"number\">200</span>,</span><br><span class=\"line\">        <span class=\"attr\">height</span>: <span class=\"number\">21</span>,</span><br><span class=\"line\">        <span class=\"attr\">field</span>: field.<span class=\"property\">fieldCode</span> ? <span class=\"string\">`<span class=\"subst\">$&#123;field.fieldCode&#125;</span>`</span> : item.<span class=\"property\">fieldCode</span>,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123; type, options &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 格式化表格数据为打印组件所需格式</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Array</span>&#125; <span class=\"variable\">tableData</span> - 原始数据</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@returns</span> &#123;<span class=\"type\">Array</span>&#125; - 格式化后的数据</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"title function_\">formatTableData</span> = (<span class=\"params\">tableData</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!tableData || !<span class=\"title class_\">Array</span>.<span class=\"title function_\">isArray</span>(tableData) || tableData.<span class=\"property\">length</span> === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  tableData.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 根据字段类型设置不同的显示方式</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> baseOptions = &#123;</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">21</span>,</span><br><span class=\"line\">      <span class=\"attr\">fontSize</span>: <span class=\"number\">14</span>,</span><br><span class=\"line\">      <span class=\"attr\">lineHeight</span>: <span class=\"number\">21</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取类型和选项</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; type, options &#125; = <span class=\"title function_\">getTypeAndOptions</span>(</span><br><span class=\"line\">      item.<span class=\"property\">fieldType</span>,</span><br><span class=\"line\">      baseOptions,</span><br><span class=\"line\">      item</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 基本字段信息</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> formattedItem = &#123;</span><br><span class=\"line\">      <span class=\"attr\">tid</span>: <span class=\"string\">`metadataModule.<span class=\"subst\">$&#123;item.fieldCode&#125;</span>`</span>,</span><br><span class=\"line\">      <span class=\"attr\">title</span>: item.<span class=\"property\">fieldName</span>,</span><br><span class=\"line\">      <span class=\"attr\">type</span>: type,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">21</span>,</span><br><span class=\"line\">      <span class=\"attr\">custom</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      <span class=\"attr\">customText</span>: item.<span class=\"property\">fieldName</span>,</span><br><span class=\"line\">      <span class=\"attr\">options</span>: options,</span><br><span class=\"line\">      <span class=\"attr\">data</span>: <span class=\"string\">`@<span class=\"subst\">$&#123;item.fieldCode&#125;</span>`</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 处理关联字段和子表</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (item.<span class=\"property\">fieldType</span> === <span class=\"string\">&quot;relation&quot;</span> || item.<span class=\"property\">fieldType</span> === <span class=\"string\">&quot;sub_table&quot;</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 确保关联字段存在</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (</span><br><span class=\"line\">        item.<span class=\"property\">fieldAssociation</span> &amp;&amp;</span><br><span class=\"line\">        item.<span class=\"property\">fieldAssociation</span>.<span class=\"property\">associationFields</span> &amp;&amp;</span><br><span class=\"line\">        <span class=\"title class_\">Array</span>.<span class=\"title function_\">isArray</span>(item.<span class=\"property\">fieldAssociation</span>.<span class=\"property\">associationFields</span>)</span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 过滤出非系统字段</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> nonSystemFields = item.<span class=\"property\">fieldAssociation</span>.<span class=\"property\">associationFields</span>.<span class=\"title function_\">filter</span>(</span><br><span class=\"line\">          <span class=\"function\">(<span class=\"params\">field</span>) =&gt;</span> field.<span class=\"property\">systemFlag</span> === <span class=\"number\">0</span></span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 为每个非系统字段创建子项</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> childItems = nonSystemFields.<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">field</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">// 为子项设置类型和选项</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> childBaseOptions = &#123;</span><br><span class=\"line\">            <span class=\"attr\">height</span>: <span class=\"number\">21</span>,</span><br><span class=\"line\">            <span class=\"attr\">fontSize</span>: <span class=\"number\">14</span>,</span><br><span class=\"line\">            <span class=\"attr\">lineHeight</span>: <span class=\"number\">21</span>,</span><br><span class=\"line\">          &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// 获取类型和选项</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> &#123; <span class=\"attr\">type</span>: childType, <span class=\"attr\">options</span>: childOptions &#125; = <span class=\"title function_\">getTypeAndOptions</span>(</span><br><span class=\"line\">            field.<span class=\"property\">fieldType</span>,</span><br><span class=\"line\">            childBaseOptions,</span><br><span class=\"line\">            item,</span><br><span class=\"line\">            field</span><br><span class=\"line\">          );</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">const</span> childItem = &#123;</span><br><span class=\"line\">            <span class=\"attr\">tid</span>: <span class=\"string\">`metadataModule.<span class=\"subst\">$&#123;item.fieldCode&#125;</span>.<span class=\"subst\">$&#123;field.fieldCode&#125;</span>`</span>,</span><br><span class=\"line\">            <span class=\"attr\">title</span>: field.<span class=\"property\">fieldName</span>,</span><br><span class=\"line\">            <span class=\"attr\">type</span>: childType,</span><br><span class=\"line\">            <span class=\"attr\">height</span>: <span class=\"number\">21</span>,</span><br><span class=\"line\">            <span class=\"attr\">custom</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            <span class=\"attr\">customText</span>: field.<span class=\"property\">fieldName</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: childOptions,</span><br><span class=\"line\">            <span class=\"attr\">data</span>: <span class=\"string\">`@<span class=\"subst\">$&#123;item.fieldCode&#125;</span>.<span class=\"subst\">$&#123;field.fieldCode&#125;</span>`</span>,</span><br><span class=\"line\">          &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// 如果是子表字段，添加子表标识</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (item.<span class=\"property\">fieldType</span> === <span class=\"string\">&quot;sub_table&quot;</span>) &#123;</span><br><span class=\"line\">            childItem.<span class=\"property\">isSubTableField</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            childItem.<span class=\"property\">parentFieldCode</span> = item.<span class=\"property\">fieldCode</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">return</span> childItem;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//字段是表格，添加表格数据</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (item.<span class=\"property\">fieldType</span> === <span class=\"string\">&quot;sub_table&quot;</span>) &#123;</span><br><span class=\"line\">          formattedItem = &#123;</span><br><span class=\"line\">            ...formattedItem,</span><br><span class=\"line\">            <span class=\"attr\">editable</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            <span class=\"attr\">columnDisplayEditable</span>: <span class=\"literal\">true</span>, <span class=\"comment\">//列显示是否能编辑</span></span><br><span class=\"line\">            <span class=\"attr\">columnDisplayIndexEditable</span>: <span class=\"literal\">true</span>, <span class=\"comment\">//列顺序显示是否能编辑</span></span><br><span class=\"line\">            <span class=\"attr\">columnTitleEditable</span>: <span class=\"literal\">true</span>, <span class=\"comment\">//列标题是否能编辑</span></span><br><span class=\"line\">            <span class=\"attr\">columnResizable</span>: <span class=\"literal\">true</span>, <span class=\"comment\">//列宽是否能调整</span></span><br><span class=\"line\">            <span class=\"attr\">columnAlignEditable</span>: <span class=\"literal\">true</span>, <span class=\"comment\">//列对齐是否调整</span></span><br><span class=\"line\">            <span class=\"attr\">field</span>: item.<span class=\"property\">fieldCode</span>,</span><br><span class=\"line\">            <span class=\"attr\">fields</span>: childItems.<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">field</span>) =&gt;</span> (&#123;</span><br><span class=\"line\">              <span class=\"attr\">text</span>: field.<span class=\"property\">title</span>,</span><br><span class=\"line\">              <span class=\"attr\">field</span>: field.<span class=\"property\">options</span>?.<span class=\"property\">field</span> || field.<span class=\"property\">fieldCode</span>,</span><br><span class=\"line\">            &#125;)),</span><br><span class=\"line\">            <span class=\"attr\">columns</span>: [</span><br><span class=\"line\">              childItems.<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">field</span>) =&gt;</span> (&#123;</span><br><span class=\"line\">                <span class=\"attr\">title</span>: field.<span class=\"property\">title</span>,</span><br><span class=\"line\">                <span class=\"attr\">align</span>: <span class=\"string\">&quot;center&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">field</span>: field.<span class=\"property\">options</span>?.<span class=\"property\">field</span> || field.<span class=\"property\">fieldCode</span>,</span><br><span class=\"line\">                <span class=\"attr\">width</span>: <span class=\"number\">100</span>,</span><br><span class=\"line\">                <span class=\"attr\">checked</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                <span class=\"attr\">columnId</span>: field.<span class=\"property\">options</span>?.<span class=\"property\">field</span> || field.<span class=\"property\">fieldCode</span>,</span><br><span class=\"line\">                <span class=\"attr\">fixed</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">                <span class=\"comment\">// 自定义渲染函数，没有数据的话就用title占位，这样好看点</span></span><br><span class=\"line\">                <span class=\"attr\">renderFormatter</span>:</span><br><span class=\"line\">                  <span class=\"string\">&quot;function(value,row,index,options)&#123;return `$&#123;value || &#x27;@&#x27; + options.columns[0].columns[index].title&#125;`&#125;&quot;</span>,</span><br><span class=\"line\">              &#125;)),</span><br><span class=\"line\">            ],</span><br><span class=\"line\">          &#125;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 将子项数组添加到当前项的 children 属性中</span></span><br><span class=\"line\">        formattedItem.<span class=\"property\">children</span> = childItems;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加当前项到结果数组</span></span><br><span class=\"line\">    result.<span class=\"title function_\">push</span>(formattedItem);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> formatTableData;</span><br></pre></td></tr></table></figure>\n\n<p>结构和初始化模板</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;el-menu class=&quot;content-bottom-left&quot; :default-openeds=&quot;[&#x27;1&#x27;]&quot;&gt;</span><br><span class=\"line\">          &lt;el-sub-menu index=&quot;1&quot;&gt;</span><br><span class=\"line\">            &lt;template #title&gt;</span><br><span class=\"line\">              &lt;el-icon&gt;&lt;FolderOpened /&gt;&lt;/el-icon&gt;</span><br><span class=\"line\">              &lt;span&gt;元数据信息&lt;/span&gt;</span><br><span class=\"line\">            &lt;/template&gt;</span><br><span class=\"line\">            &lt;el-sub-menu</span><br><span class=\"line\">              v-for=&quot;(value, index) in metaDataList&quot;</span><br><span class=\"line\">              :key=&quot;value.tid&quot;</span><br><span class=\"line\">              :tid=&quot;value.tid&quot;</span><br><span class=\"line\">              :class=&quot;</span><br><span class=\"line\">                value.children &amp;&amp; value.type == &#x27;text&#x27;</span><br><span class=\"line\">                  ? &#x27;&#x27;</span><br><span class=\"line\">                  : &#x27;ep-draggable-item item no-icon&#x27;</span><br><span class=\"line\">              &quot;</span><br><span class=\"line\">              class=&quot;content-bottom-left-sub&quot;</span><br><span class=\"line\">              :index=&quot;&#x27;1-1-&#x27; + index&quot;</span><br><span class=\"line\">            &gt;</span><br><span class=\"line\">              &lt;template #title&gt;</span><br><span class=\"line\">                &lt;el-icon&gt;&lt;Document /&gt;&lt;/el-icon&gt;</span><br><span class=\"line\">                &lt;span&gt;&#123;&#123; value.title &#125;&#125;&lt;/span&gt;</span><br><span class=\"line\">              &lt;/template&gt;</span><br><span class=\"line\">              &lt;el-menu-item</span><br><span class=\"line\">                v-for=&quot;item in value.children&quot;</span><br><span class=\"line\">                :key=&quot;item.tid&quot;</span><br><span class=\"line\">                :disabled=&quot;item.isSubTableField&quot;</span><br><span class=\"line\">                :class=&quot;item.isSubTableField ? &#x27;&#x27; : &#x27;ep-draggable-item item&#x27;&quot;</span><br><span class=\"line\">                :tid=&quot;item.tid&quot;</span><br><span class=\"line\">              &gt;</span><br><span class=\"line\">                &lt;el-icon&gt;&lt;Document /&gt;&lt;/el-icon&gt;</span><br><span class=\"line\">                &lt;span&gt;&#123;&#123; item.title &#125;&#125;&lt;/span&gt;</span><br><span class=\"line\">              &lt;/el-menu-item&gt;</span><br><span class=\"line\">            &lt;/el-sub-menu&gt;</span><br><span class=\"line\">          &lt;/el-sub-menu&gt;</span><br><span class=\"line\">        &lt;/el-menu&gt;</span><br><span class=\"line\">  &lt;!-- 这里是打印设计器 --&gt;</span><br><span class=\"line\">   &lt;div class=&quot;overflow-auto item-print&quot;&gt;</span><br><span class=\"line\">        &lt;div id=&quot;hiprint-printTemplate&quot; /&gt;</span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">      &lt;!-- 这里是打印参数设置 --&gt;</span><br><span class=\"line\">      &lt;div class=&quot;overflow-auto item-el&quot;&gt;</span><br><span class=\"line\">        &lt;div id=&quot;print-element-option-setting&quot; /&gt;</span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\">&lt;script setup&gt;</span><br><span class=\"line\">import &#123; ref, onMounted &#125; from &quot;vue&quot;;</span><br><span class=\"line\">import &#123; hiprint &#125; from &quot;vue-plugin-hiprint&quot;;</span><br><span class=\"line\">import basicData from &quot;./basicData&quot;;</span><br><span class=\"line\">import &#123; createProviderBasic,createMetadataProvider &#125; from &quot;./utils/provider&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">onMounted(() =&gt; &#123;</span><br><span class=\"line\">  buildDesigner()</span><br><span class=\"line\">  buildLeftElement();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">const buildLeftElement = () =&gt; &#123;</span><br><span class=\"line\">  hiprint.PrintElementTypeManager.buildByHtml($(&quot;.ep-draggable-item&quot;));</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">let hiprintTemplate;</span><br><span class=\"line\">const buildDesigner = () =&gt; &#123;</span><br><span class=\"line\">  $(&quot;#hiprint-printTemplate&quot;).empty(); // 先清空, 避免重复构建</span><br><span class=\"line\">  hiprintTemplate = new hiprint.PrintTemplate(&#123;</span><br><span class=\"line\">    settingContainer: &quot;#print-element-option-setting&quot;, // 元素参数容器</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  // 构建 并填充到 容器中</span><br><span class=\"line\">  hiprintTemplate.design(&quot;#hiprint-printTemplate&quot;, &#123;</span><br><span class=\"line\">    grid: true //可以设置网格化</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">// 更新打印模板，重新构建</span><br><span class=\"line\">const updatePrintTemplate = () =&gt; &#123;</span><br><span class=\"line\">  if (metaDataList.value.length &gt; 0) &#123;</span><br><span class=\"line\">    hiprint.init(&#123;</span><br><span class=\"line\">      providers: [</span><br><span class=\"line\">        createProviderBasic(basicData),</span><br><span class=\"line\">        createMetadataProvider(metaDataList.value)</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    nextTick(() =&gt; &#123;</span><br><span class=\"line\">      // 重新构建左侧元素</span><br><span class=\"line\">      buildLeftElement();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">//监听数据，处理数据</span><br><span class=\"line\">watch(</span><br><span class=\"line\">  () =&gt; props.tableData,</span><br><span class=\"line\">  (newVal, oldVal) =&gt; &#123;</span><br><span class=\"line\">    if (newVal.length &gt; 0 &amp;&amp; newVal !== oldVal) &#123;</span><br><span class=\"line\">      // 格式化表格数据</span><br><span class=\"line\">      const formattedData = formatTableData(newVal);</span><br><span class=\"line\">      // 更新数据列表</span><br><span class=\"line\">      metaDataList.value = formattedData;</span><br><span class=\"line\">      // 重新初始化打印模板</span><br><span class=\"line\">      updatePrintTemplate();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123; deep: true, immediate: true &#125;</span><br><span class=\"line\">);</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n<p>初始化设计器时需要一维数组，所以这里又定义一个方法把数据拉平，再创建</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> createMetadataProvider = <span class=\"keyword\">function</span> (<span class=\"params\">options</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 将嵌套的 children 拉平为一维数组</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"title function_\">flattenOptions</span> = items =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> item <span class=\"keyword\">of</span> items) &#123;</span><br><span class=\"line\">      result.<span class=\"title function_\">push</span>(&#123; ...item &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (</span><br><span class=\"line\">        item.<span class=\"property\">children</span> &amp;&amp;</span><br><span class=\"line\">        <span class=\"title class_\">Array</span>.<span class=\"title function_\">isArray</span>(item.<span class=\"property\">children</span>) &amp;&amp;</span><br><span class=\"line\">        item.<span class=\"property\">children</span>.<span class=\"property\">length</span> &gt; <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">        item.<span class=\"property\">type</span> !== <span class=\"string\">&quot;table&quot;</span></span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        result = result.<span class=\"title function_\">concat</span>(<span class=\"title function_\">flattenOptions</span>(item.<span class=\"property\">children</span>));</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> processedOptions = <span class=\"title class_\">Array</span>.<span class=\"title function_\">isArray</span>(options)</span><br><span class=\"line\">    ? <span class=\"title function_\">flattenOptions</span>(options)</span><br><span class=\"line\">    : options;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title function_\">createProviderBasic</span>(processedOptions, <span class=\"string\">&quot;metadataModule&quot;</span>);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>至此，动态生成设计器就完成了，具体效果如下</p>\n<img src=\"/images/custom.gif\" width=\"500\" height=\"300\">\n\n\n<h2 id=\"一些问题记录\"><a href=\"#一些问题记录\" class=\"headerlink\" title=\"一些问题记录\"></a>一些问题记录</h2><p>预览时，如果表格数据分页了，发现第二页没有页眉间距，效果一言难尽，查了文档才发现是有页眉页脚分割线的，还可以拖拽自定义位置，但是很难看到，手动更改了一下样式</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* 修改 页眉/页脚线 样式 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.hiprint-headerLine</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.hiprint-footerLine</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border-color</span>: red <span class=\"meta\">!important</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.hiprint-headerLine</span><span class=\"selector-pseudo\">:hover</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.hiprint-footerLine</span><span class=\"selector-pseudo\">:hover</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border-top</span>: <span class=\"number\">3px</span> dashed red <span class=\"meta\">!important</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.hiprint-headerLine</span><span class=\"selector-pseudo\">:hover</span><span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: -<span class=\"number\">12px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">left</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">50%</span> - <span class=\"number\">18px</span>);</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">12px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">  <span class=\"attribute\">content</span>: <span class=\"string\">&quot;页眉线&quot;</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"number\">#ffff</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.hiprint-footerLine</span><span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: -<span class=\"number\">10px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">left</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">50%</span> - <span class=\"number\">18px</span>);</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">12px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">  <span class=\"attribute\">content</span>: <span class=\"string\">&quot;页脚线&quot;</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"number\">#ffff</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>另外可以在初始化容器时手动初始化一下页眉位置，这样就不会有问题了</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> panels = <span class=\"title function_\">ref</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">panels</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">height</span>: <span class=\"number\">297</span>, <span class=\"comment\">//默认a4纸高度</span></span><br><span class=\"line\">      <span class=\"attr\">width</span>: <span class=\"number\">210</span>, <span class=\"comment\">//默认a4纸宽度</span></span><br><span class=\"line\">      <span class=\"attr\">paperHeader</span>: <span class=\"number\">28</span>, <span class=\"comment\">// 页眉高度</span></span><br><span class=\"line\">      <span class=\"attr\">paperFooter</span>: <span class=\"number\">0</span>, <span class=\"comment\">//页脚高度</span></span><br><span class=\"line\">      <span class=\"attr\">printElements</span>: []</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">hiprintTemplate = <span class=\"keyword\">new</span> hiprint.<span class=\"title class_\">PrintTemplate</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">settingContainer</span>: <span class=\"string\">&quot;#print-element-option-setting&quot;</span>, <span class=\"comment\">// 元素参数容器</span></span><br><span class=\"line\">    <span class=\"attr\">template</span>: panels.<span class=\"property\">value</span>,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<img src=\"/images/pageFooter.gif\" width=\"500\" height=\"300\">\n\n<p>需求里有些field字段不能修改，本来用样式 <code>print-element-option-setting input[placeholder=&quot;请输入字段名&quot;]</code> 手动禁止修改了，后来又说基础设计器可以手动输入字段名，用来打印获取数据，想了很久最后发现有方法可以把field隐藏。</p>\n<p>setOptionConfig 方法设置了 type为这些的参数为基本的，name为field的hidden为true，这样就隐藏了。</p>\n<p>如果需要隐藏其它参数，可以打印一下 window 找到下面HIPRINT_CONFIG来看详细参数。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">setOptionConfig</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  hiprint.<span class=\"title function_\">setConfig</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">text</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">tabs</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">name</span>: <span class=\"string\">&quot;基本&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">options</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">name</span>: <span class=\"string\">&quot;field&quot;</span>,</span><br><span class=\"line\">              <span class=\"attr\">hidden</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">table</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">tabs</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">name</span>: <span class=\"string\">&quot;基本&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">options</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">name</span>: <span class=\"string\">&quot;field&quot;</span>,</span><br><span class=\"line\">              <span class=\"attr\">hidden</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">longText</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">tabs</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">name</span>: <span class=\"string\">&quot;基本&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">options</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">name</span>: <span class=\"string\">&quot;field&quot;</span>,</span><br><span class=\"line\">              <span class=\"attr\">hidden</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">打印时如果 field字段为 a.<span class=\"property\">b</span>.<span class=\"property\">c</span> 这种格式, 那打印数据可以是这样的结构,可以嵌套</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">a</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">b</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">c</span>: <span class=\"string\">&#x27;123&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","text":"最近后台管理新增一个可视化编辑器并可以打印的功能，调研了 hiprint，不过后面发现了有位大佬用 hiprint 二次开发了 vue 插件，经过调研使用了 v...","permalink":"/post/print","photos":[],"count_time":{"symbolsCount":"18k","symbolsTime":"16 mins."},"categories":[{"name":"vue3","slug":"vue3","count":2,"path":"api/categories/vue3.json"}],"tags":[{"name":"tools","slug":"tools","count":4,"path":"api/tags/tools.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E6%9C%AC%E8%AE%BE%E8%AE%A1%E5%99%A8\"><span class=\"toc-text\">基本设计器</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8A%A8%E6%80%81%E8%8E%B7%E5%8F%96%E8%AE%BE%E8%AE%A1%E5%99%A8\"><span class=\"toc-text\">动态获取设计器</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95\"><span class=\"toc-text\">一些问题记录</span></a></li></ol>","author":{"name":"M","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"这是我的博客","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"逐帧动画实现无限轮播","uid":"92e648db1789cade1fa84cef6b1bbfe8","slug":"animation-steps","date":"2022-11-26T08:01:04.000Z","updated":"2024-10-09T13:12:13.695Z","comments":true,"path":"api/articles/animation-steps.json","keywords":null,"cover":"/images/cover1.jpg","text":"最近有一个无限滚动轮播的需求，最开始用js+延时器写了一版，但因为是用在首页性能消耗很大，所以想试试能不能用css搞定，嘿，还真发现了一种方法，虽然最后没有使用...","permalink":"/post/animation-steps","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"css","slug":"css","count":2,"path":"api/categories/css.json"},{"name":"animation","slug":"css/animation","count":2,"path":"api/categories/css/animation.json"}],"tags":[{"name":"animation","slug":"animation","count":3,"path":"api/tags/animation.json"}],"author":{"name":"M","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"这是我的博客","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"二次封装图片裁切组件","uid":"dd5ab0341bc990a4e66b615b8fc3d65b","slug":"imageCropper","date":"2025-07-26T03:34:56.000Z","updated":"2025-09-18T09:01:04.397Z","comments":true,"path":"api/articles/imageCropper.json","keywords":null,"cover":"/images/cover1.jpg","text":"二次封装图片裁切组件最近有个需求上传图片后，需要裁切图片，然后上传到阿里OSS服务器，这里记录一下封装的组件代码. 最外层弹窗代码<template> <div...","permalink":"/post/imageCropper","photos":[],"count_time":{"symbolsCount":"25k","symbolsTime":"23 mins."},"categories":[{"name":"vue3","slug":"vue3","count":2,"path":"api/categories/vue3.json"},{"name":"element-plus","slug":"vue3/element-plus","count":1,"path":"api/categories/vue3/element-plus.json"}],"tags":[{"name":"components","slug":"components","count":4,"path":"api/tags/components.json"}],"author":{"name":"M","slug":"blog-author","avatar":"/images/avatar.jpg","link":"/","description":"这是我的博客","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}